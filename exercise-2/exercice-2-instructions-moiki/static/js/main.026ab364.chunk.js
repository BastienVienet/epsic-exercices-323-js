(this["webpackJsonpmoiki-player"]=this["webpackJsonpmoiki-player"]||[]).push([[0],{335:function(e,t,n){},355:function(e){e.exports=JSON.parse('{"a":"0.7.9"}')},356:function(e,t,n){e.exports=n.p+"static/media/logo.aa710516.svg"},373:function(e,t,n){e.exports=n(682)},632:function(e,t,n){},643:function(e,t,n){},644:function(e,t,n){},648:function(e,t,n){},650:function(e,t,n){},651:function(e,t,n){},652:function(e,t,n){},653:function(e,t){},679:function(e,t,n){},681:function(e,t,n){},682:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"standard",(function(){return A})),n.d(a,"dark",(function(){return U})),n.d(a,"army",(function(){return H})),n.d(a,"oldScreen",(function(){return P})),n.d(a,"comic",(function(){return W})),n.d(a,"pastel",(function(){return V})),n.d(a,"barbie",(function(){return G})),n.d(a,"sunny",(function(){return Y})),n.d(a,"basic",(function(){return J})),n.d(a,"book",(function(){return K})),n.d(a,"caraibean",(function(){return Z})),n.d(a,"city",(function(){return X})),n.d(a,"classic",(function(){return $})),n.d(a,"dream",(function(){return Q})),n.d(a,"geek",(function(){return ee})),n.d(a,"green",(function(){return te})),n.d(a,"horror",(function(){return ne})),n.d(a,"night",(function(){return ae})),n.d(a,"pop",(function(){return re})),n.d(a,"space",(function(){return oe}));var r={};n.r(r),n.d(r,"superhero",(function(){return ce})),n.d(r,"glow",(function(){return le})),n.d(r,"retro",(function(){return ie})),n.d(r,"inset",(function(){return se})),n.d(r,"longShadow",(function(){return ue}));n(374),n(393);var o=n(0),c=n.n(o),l=n(345),i=n.n(l),s=n(2),u=n(155),d=n(3),m=n(27),f=n(11),b=n(32),g=n(135),y=n(181),v=n.n(y),p=n(346),E=n(12),h=n(361),O={fade:{label:"Fade",data:{from:{opacity:0},to:{opacity:1},config:{duration:350,easing:E.c.easeOutCubic}}},zoom:{label:"Zoom",data:{from:{transform:"scale(0)"},to:{transform:"scale(1)"},config:{duration:350,easing:E.c.easeOutCubic}}},rotateZoom:{label:"Rotation",data:{from:{transform:"scale(0) rotate(0deg)"},to:{transform:"scale(1) rotate(720deg)"},config:{duration:550,easing:E.c.easeOutCubic}}}},S={kinds:O,decorators:["star"],getAnimationStyle:function(e){return(O[e]||O.zoom).data}},j={fade:{label:"Fade",fn:function(){return""}},zoom:{label:"Zoom",fn:function(e){var t=1-e/100;return"translateY(".concat(e,"px) scale(").concat(t,", ").concat(t,")")}},unzoom:{label:"Dezoom",fn:function(e){var t=1+e/100;return"translateY(".concat(e,"px) scale(").concat(t,", ").concat(t,")")}},pop:{label:"Rotation",fn:function(e){var t=90-90*(1-Math.abs(e)/100);return"translateY(".concat(e,"px) rotateY(-").concat(t,"deg)")}}},k={kinds:j,getAnimationStyle:function(e){return(j[e]||j.unzoom).fn}},x={fade:{label:"Fade",data:{from:{opacity:0},to:{opacity:1},config:{duration:350,easing:E.c.easeOutCubic}}},zoom:{label:"Zoom",data:{from:{transform:"scale(0)"},to:{transform:"scale(1)"},config:{duration:350,easing:E.c.easeOutCubic}}},rotateZoom:{label:"Rotation",data:{from:{transform:"scale(0) rotate(0deg)"},to:{transform:"scale(1) rotate(720deg)"},config:{duration:550,easing:E.c.easeOutCubic}}}},q={kinds:x,decorators:["dices"],getAnimationStyle:function(e){return(x[e]||x.zoom).data}},w=n(182),C=n.n(w),R=n(700),T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\s([?!:\xbb])/g,"\xa0$1").replace(/(\xab)\s/g,"$1\xa0")},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/\s([?!:\xbb])/g,"&nbsp;$1").replace(/(\xab)\s/g,"$1&nbsp;")},z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return B(C.a.sanitize(e,t))},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/(\s*&nbsp;\s*)+/g,'<span class="unbreak-spaces">&nbsp;</span>')},I=function(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))},M=function(e){for(var t=Object(f.a)(e).map((function(e,t){return Object(d.a)({},e,{originalIndex:t})})),n=t.length-1;n>0;n--){var a=Math.floor(Math.random()*(n+1)),r=t[n];t[n]=t[a],t[a]=r}return t},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/<span class="ql-moikivar"([^>]+)>([^<]+)<\/span>/gim,"{$2}").replace(/(<([^>]+)>)/gi,"").replace(/&nbsp;/gi," ").replace(/\u200c/gi," ").replace(/([?.:!]{1})(\w)/gi,"$1 $2").replace(/\.\s\.\./gi,"...").trim()},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"one",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=t.filter((function(e){return a.includes(e)}));if(e&&e.tags&&r.length>0)switch(n){case"all":return r.every((function(t){return e.tags.indexOf(t)>=0}));case"nonce":return!r.some((function(t){return e.tags.indexOf(t)>=0}));default:return r.some((function(t){return e.tags.indexOf(t)>=0}))}return!0},_={fr:{PRESENT:"Moiki pr\xe9sente",STORY_BY:"Une histoire de",ADAPTED_BY:"adaptation Moiki par",CREDITS:"Cr\xe9dits",COVER:"Image de couverture",IMAGES:"Images / Photos",ALL_RIGHTS_RESERVED:"Droits r\xe9serv\xe9s",ICONS:"Ic\xf4nes",ICONS_FROM:"Toutes les ic\xf4nes proviennent de",LICENSE:"licence:",SOUNDS:"Sons",SOUNDS_FROM:"Tous les sons proviennent de",PROGRESSION:"Progression",SEQ_FOUND:"S\xe9quences d\xe9couvertes :",HEROES_FOUND:"H\xe9ros obtenus :",OBJ_FOUND:"Objets d\xe9couverts :",STATS:"Stats",SHOW_STATS:"voir les stats",NUM_UNDO:"Retours en arri\xe8re :",NUM_GAMES:"Parties commenc\xe9es :",NUM_VICTORIES:"Nombre de victoires :",NUM_DEFEATS:"Nombre de d\xe9faites :",RESTART:"Recommencer",RESET:"R\xe9initialiser et recommencer",RETRY:"R\xe9essayer",REPORT:"signaler ce contenu",REPORT_THIS:"Signaler",SHOW_CREDITS:"voir les cr\xe9dits",REPORT_SENT:"Signalement envoy\xe9 !",RETRY_REASON:"Je souhaite signaler cette histoire pour la raison suivante\xa0:",OFFENSIVE:"Caract\xe8re offensant",DUPLICATA:"Contenu dupliqu\xe9 (plagiat)",OTHER_REASON:"Autre raison",USEFUL_INFO:"Informations utiles",SEND:"Envoyer",LOADING_SOUNDS:"t\xe9l\xe9chargement des sons",OBJ_WON:"Inventaire",NO_OBJ_WON:"Votre inventaire est vide",READ_MORE:"En savoir plus",MORE_INFO:"Plus d'info",REVIEWS:"Avis",SHARE:"Partager",BACK:"Retour",UNKNOWN:"Inconnu",RESUME:"Reprendre ?",RESUME_MSG:"Voulez-vous reprendre votre partie en cours\xa0?",RESUME_DATE:"sauvegard\xe9e il y a %s",RESUME_ALERT:"En choisissant de commencer une nouvelle partie, votre sauvegarde sera perdue\xa0!",DO_NOT_RESUME:"Recommencer depuis le d\xe9but",LOAD:"Reprendre la partie",RESET_GAME:"R\xe9initialiser",RESET_MSG:"En r\xe9initialisant le jeu, vous repartirez depuis le d\xe9but et vos statistiques seront remises \xe0 z\xe9ro.",RESTART_MSG:"En recommen\xe7ant le jeu, vous repartirez depuis le d\xe9but en conservant vos statistiques.",WILL_LOSE_BACKUP:"Attention, votre sauvegarde sera perdue\xa0!",CANCEL:"Annuler",START_OF_ROUTINE:"D\xc9BUT DE LA ROUTINE\xa0:",END_OF_ROUTINE:"FIN DE LA ROUTINE",ITS_FREE:"est une plateforme permettant de cr\xe9er des histoires \xe0 embranchements.",ERROR:"Erreur",SOUNDS_ERROR:"Oh non, il y a un probl\xe8me avec les sons !",SOUNDS_ERROR_MSG:"Il semblerait que le service qui permet d'avoir du son dans Moiki (freesound.org) soit tomb\xe9 dans les choux...",OBJECT_SELECTOR:"[Affichera le s\xe9lecteur d'objets]"},en:{PRESENT:"Moiki presents",STORY_BY:"A story by",ADAPTED_BY:"Moiki adaptation by",CREDITS:"Credits",COVER:"Cover picture",IMAGES:"Images / Pictures",ALL_RIGHTS_RESERVED:"All rights reserved",ICONS:"Icons",ICONS_FROM:"All icons come from",LICENSE:"license:",SOUNDS:"Sounds",SOUNDS_FROM:"All sounds come from",PROGRESSION:"Progression",SEQ_FOUND:"Discovered sequences:",HEROES_FOUND:"Heroes obtained:",OBJ_FOUND:"Objects discovered:",STATS:"Stats",SHOW_STATS:"see stats",NUM_UNDO:"Backwards:",NUM_GAMES:"Started games:",NUM_VICTORIES:"Number of wins:",NUM_DEFEATS:"Number of defeats:",RESTART:"Start again",RESET:"Reset and restart",RETRY:"Retry",REPORT:"report this content",REPORT_THIS:"Report",SHOW_CREDITS:"see credits",REPORT_SENT:"Report sent!",REPORT_REASON:"I would like to report this story for the following reason:",OFFENSIVE:"Offensive nature",DUPLICATA:"Duplicate content (plagiarism)",OTHER_REASON:"Other reason",USEFUL_INFO:"Useful information",SEND:"Send",LOADING_SOUNDS:"downloading sounds",OBJ_WON:"Inventory",NO_OBJ_WON:"Your inventory is empty",READ_MORE:"Read more",MORE_INFO:"More info",REVIEWS:"Reviews",SHARE:"Share",BACK:"Back",UNKNOWN:"Unknown",RESUME:"Resume?",RESUME_MSG:"Do you want to resume your game in progress?",RESUME_DATE:"saved %s ago",RESUME_ALERT:"By choosing to start a new game, your backup will be lost!",DO_NOT_RESUME:"Start a new game",LOAD:"Resume the game",RESET_GAME:"Reset",RESET_MSG:"By resetting the game, you will start from the beginning and your statistics will be reset to zero.",RESTART_MSG:"By restarting the game, you will start again from the beginning by keeping your statistics.",WILL_LOSE_BACKUP:"Be careful, your backup will be lost!",CANCEL:"Cancel",START_OF_ROUTINE:"START OF ROUTINE:",END_OF_ROUTINE:"END OF ROUTINE",ITS_FREE:"is a platform to create branching stories.",ERROR:"Error",SOUNDS_ERROR:"Oh no, there's a problem with sounds!",SOUNDS_ERROR_MSG:"It would seem that the service that lets you have sound in Moiki (freesound.org) has fallen on hard times...",OBJECT_SELECTOR:"[Will display the object selector]"}},D=Object(o.createContext)(_.fr),A={name:"standard",styles:{background:"#4c77ac",fontFamily:"Catamaran",topbarBackground:"#154f6b",topbarText:"#ffffff",sequenceBackground:"#446a9a",sequenceText:"#ffffff",buttonBackground:"#4eb5f1",buttonText:"#ffffff",assetsBackground:"rgba(21, 79, 107, 0.27)",assetsFill:"#ffffff",sequenceRadius:1,buttonRadius:1,sfx:{},animations:{sequence:"unzoom",objectModal:"zoom",objectModalDecorator:"star"},textStyle:{type:"sans"}}},U={name:"dark",styles:{background:"rgba(0, 0, 0, 1)",fontFamily:"Londrina Solid",buttonBackground:"rgba(255, 255, 255, 0.18)",sequenceBackground:"rgba(0, 0, 0, 0.8)",assetsBackground:"rgba(0, 0, 0, 0.76)",sequenceText:"rgba(255, 255, 255, 1)",topbarBackground:"rgba(22, 31, 31, 1)",topbarText:"rgba(131, 130, 130, 1)",assetsFill:"rgba(255, 255, 255, 1)",sfx:{},animations:{sequence:"fade",objectModal:"rotateZoom",objectModalDecorator:"star"},textStyle:{type:"sans"}}},H={name:"army",styles:{textStyle:{params:{color:"rgba(156, 221, 91, 1)",color2:"rgba(65, 117, 5, 1)",size:1.5},type:"glow"},animations:{sequence:"fade",objectModal:"zoom",objectModalDecorator:"star"},background:"rgba(104, 151, 53, 1)",fontFamily:"Black Ops One",buttonBackground:"rgba(255, 255, 255, 0.18)",sequenceBackground:"rgba(125, 179, 69, 0.9)",assetsBackground:"rgba(65, 117, 5, 1)",sequenceText:"rgba(51, 51, 48, 1)",topbarBackground:"rgba(126, 211, 33, 0.69)",topbarText:"rgba(65, 117, 5, 1)",assetsFill:"rgba(184, 233, 134, 1)",sfx:{}}},P={name:"old-screen",styles:{background:"rgba(0, 0, 0, 1)",fontFamily:"Ubuntu",topbarBackground:"rgba(0, 0, 0, 1)",topbarText:"rgba(110, 169, 37, 1)",sequenceBackground:"rgba(0, 0, 0, 1)",sequenceText:"rgba(184, 233, 134, 1)",buttonBackground:"rgba(184, 233, 134, 1)",buttonText:"rgba(0, 0, 0, 1)",assetsBackground:"rgba(87, 126, 48, 0.59)",assetsFill:"rgba(209, 236, 182, 1)",sfx:{},animations:{sequence:"fade",objectModal:"fade"},textStyle:{type:"glow",params:{size:8,color2:"rgba(126, 211, 33, 1)",color:"rgba(65, 117, 5, 1)"}}}},W={name:"comic",styles:{background:"rgba(116, 140, 160, 1)",fontFamily:"Bowlby One SC",topbarBackground:"rgba(69, 74, 77, 1)",topbarText:"#ffffff",sequenceBackground:"rgba(161, 166, 126, 0)",sequenceText:"#ffffff",buttonBackground:"rgba(0, 0, 0, 0.23)",buttonText:"rgba(255, 255, 255, 1)",assetsBackground:"rgba(0, 0, 0, 0.23)",assetsFill:"#ffffff",sfx:{},animations:{sequence:"zoom",objectModal:"zoom"},textStyle:{type:"superhero",params:{size:3.5,color2:"rgba(158, 158, 158, 1)",color:"rgba(83, 82, 82, 1)"}}}},V={name:"pastel",styles:{background:"rgba(166, 151, 126, 1)",fontFamily:"Cantarell",topbarBackground:"rgba(69, 74, 77, 1)",topbarText:"#ffffff",sequenceBackground:"rgba(161, 166, 126, 1)",sequenceText:"#ffffff",buttonBackground:"rgba(166, 132, 126, 1)",buttonText:"#ffffff",assetsBackground:"rgba(82, 107, 21, 0)",assetsFill:"#ffffff",sfx:{},animations:{sequence:"fade",objectModal:"fade"},textStyle:{type:"glow",params:{size:1,color2:"rgba(158, 158, 158, 1)"}}}},G={name:"barbie",styles:{textStyle:{params:{color:"rgba(255, 227, 244, 1)"},type:"sans"},animations:{sequence:"unzoom",objectModal:"zoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(245, 2, 146, 1)"},sequenceBoldLock:!0,sequenceRadius:1,sequenceBorderColor:"#ffffff",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(255, 64, 143, 1)",fontFamily:"Cherry Swash",topbarBackground:"rgba(255, 173, 207, 1.00)",topbarText:"rgba(221, 39, 147, 1.00)",sequenceBackground:"rgba(221, 39, 147, 1)",sequenceText:"rgba(254, 253, 253, 1)",buttonBackground:"rgba(255, 173, 207, 1)",buttonText:"rgba(221, 39, 147, 1.00)",assetsBackground:"rgba(255, 173, 207, 1.00)",assetsFill:"rgba(221, 39, 147, 1.00)",sequenceBoldText:"rgba(254, 253, 253, 1)",inventoryBackground:"rgba(247, 54, 134, 1)"}},Y={name:"sunny",styles:{textStyle:{type:"sans"},animations:{sequence:"unzoom",objectModal:"zoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(64, 183, 252, 1.00)"},sequenceBoldLock:!1,sequenceRadius:0,sequenceBorderColor:"#ffffff",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(249, 231, 52, 1)",fontFamily:"Asap",topbarBackground:"rgba(255, 255, 255, 0.25)",topbarText:"#ffffff",sequenceBackground:"rgba(221, 248, 255, 1)",sequenceText:"rgba(47, 71, 83, 1.00)",buttonBackground:"rgba(64, 183, 252, 1)",buttonText:"#ffffff",assetsBackground:"rgba(255, 255, 255, 0.25)",assetsFill:"rgba(47, 71, 83, 1.00)",sequenceBoldText:"rgba(64, 183, 252, 1.00)",inventoryBackground:"rgba(221, 248, 255, 0.5)"}},J={name:"basic",styles:{textStyle:{type:"sans"},animations:{sequence:"fade",objectModal:"zoom",objectModalDecorator:"sans",objectModalDecoratorColor:"rgba(252, 212, 6, 1)"},sequenceBoldLock:!0,sequenceRadius:.2,sequenceBorderColor:"#ffffff",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(0, 0, 0, 1)",fontFamily:"Catamaran",topbarBackground:"rgba(252, 160, 6, 1.00)",topbarText:"rgba(0, 0, 0, 1)",sequenceBackground:"rgba(255, 255, 255, 0.9)",sequenceText:"rgba(0, 0, 0, 1)",buttonBackground:"rgba(252, 160, 6, 1.00)",buttonText:"rgba(255, 255, 255, 1)",assetsBackground:"rgba(255, 255, 255, 0.16)",assetsFill:"rgba(252, 160, 6, 1)",sequenceBoldText:"rgba(0, 0, 0, 1)",inventoryBackground:"rgba(71, 70, 70, 1)"}},K={name:"book",styles:{textStyle:{type:"sans"},animations:{sequence:"fade",objectModal:"fade",objectModalDecorator:"sans",objectModalDecoratorColor:"rgba(172, 186, 195, 1.00)"},sequenceBoldLock:!0,sequenceRadius:0,sequenceBorderColor:"rgba(172, 186, 195, 1.00)",sequenceBorderSize:1,buttonRadius:.3,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(235, 235, 235, 1)",fontFamily:"PT Serif",topbarBackground:"rgba(0, 5, 7, 0.13)",topbarText:"rgba(255, 255, 255, 0.57)",sequenceBackground:"rgba(255, 255, 255, 1)",sequenceText:"rgba(39, 39, 39, 1)",buttonBackground:"rgba(141, 131, 131, 1)",buttonText:"#ffffff",assetsBackground:"rgba(0, 5, 7, 0.13)",assetsFill:"rgba(141, 131, 131, 1.00)",sequenceBoldText:"rgba(39, 39, 39, 1)",inventoryBackground:"rgba(0, 5, 7, 0.13)"}},Z={name:"cara\xefbean",styles:{textStyle:{type:"sans"},animations:{sequence:"unzoom",objectModal:"zoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(254, 237, 122, 1.00)"},sequenceBoldLock:!1,sequenceRadius:1,sequenceBorderColor:"rgba(23, 174, 192, 1.00)",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"rgba(253, 235, 58, 1.00)",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(112, 252, 237, 1)",fontFamily:"PT Sans",topbarBackground:"rgba(18, 167, 185, 1)",topbarText:"rgba(255, 255, 255, 1)",sequenceBackground:"rgba(23, 174, 192, 1)",sequenceText:"rgba(255, 255, 255, 1)",buttonBackground:"rgba(253, 235, 58, 1)",buttonText:"rgba(18, 137, 150, 1.00)",assetsBackground:"rgba(23, 174, 192, 1.00)",assetsFill:"rgba(253, 235, 58, 1.00)",sequenceBoldText:"rgba(254, 237, 122, 1)",inventoryBackground:"rgba(23, 174, 192, 1.00)"}},X={name:"city",styles:{textStyle:{type:"sans"},animations:{sequence:"fade",objectModal:"fade",objectModalDecorator:"sans",objectModalDecoratorColor:"rgba(105, 203, 255, 1)"},sequenceBoldLock:!1,sequenceRadius:0,sequenceBorderColor:"#ffffff",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(123, 146, 175, 1)",fontFamily:"Source Sans Pro",topbarBackground:"rgba(76, 100, 130, 1.00)",topbarText:"rgba(33, 62, 95, 1)",sequenceBackground:"rgba(153, 175, 204, 1)",sequenceText:"rgba(25, 56, 96, 1.00)",buttonBackground:"rgba(199, 3, 92, 1)",buttonText:"#ffffff",assetsBackground:"rgba(76, 100, 130, 1)",assetsFill:"rgba(199, 215, 235, 1)",sequenceBoldText:"rgba(199, 3, 92, 1.00)",inventoryBackground:"rgba(255, 255, 255, 0.3)"}},$={name:"classic",styles:{textStyle:{type:"sans"},animations:{sequence:"fade",objectModal:"zoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(152, 196, 252, 1)"},sequenceBoldLock:!0,sequenceRadius:.2,sequenceBorderColor:"rgba(34, 94, 171, 1.00)",sequenceBorderSize:0,buttonRadius:.2,buttonBorderColor:"rgba(34, 94, 171, 1.00)",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(0, 42, 93, 1)",fontFamily:"Alice",topbarBackground:"rgba(0, 42, 93, 1.00)",topbarText:"rgba(255, 255, 255, 0.21)",sequenceBackground:"rgba(255, 255, 255, 1)",sequenceText:"rgba(34, 94, 171, 1.00)",buttonBackground:"rgba(34, 94, 171, 1.00)",buttonText:"rgba(255, 255, 255, 1)",assetsBackground:"rgba(255, 255, 255, 0.13)",assetsFill:"rgba(152, 196, 252, 1.00)",sequenceBoldText:"rgba(34, 94, 171, 1.00)",inventoryBackground:"rgba(152, 196, 252, 1.00)"}},Q={name:"dream",styles:{textStyle:{type:"sans"},animations:{sequence:"fade",objectModal:"zoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(255, 112, 167, 1.00)"},sequenceBoldLock:!0,sequenceRadius:1,sequenceBorderColor:"#ffffff",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(186, 236, 252, 1)",fontFamily:"Catamaran",topbarBackground:"rgba(48, 176, 244, 1)",topbarText:"#ffffff",sequenceBackground:"rgba(255, 255, 255, 1)",sequenceText:"rgba(87, 194, 251, 1.00)",buttonBackground:"rgba(255, 112, 167, 1)",buttonText:"#ffffff",assetsBackground:"rgba(87, 194, 251, 1.00)",assetsFill:"#ffffff",sequenceBoldText:"rgba(87, 194, 251, 1.00)",inventoryBackground:"rgba(48, 176, 244, 1.00)"}},ee={name:"geek",styles:{textStyle:{type:"sans"},animations:{sequence:"unzoom",objectModal:"zoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(159, 247, 71, 1.00)"},sequenceBoldLock:!0,sequenceRadius:0,sequenceBorderColor:"rgba(159, 247, 71, 1.00)",sequenceBorderSize:1,buttonRadius:0,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(0, 0, 0, 1)",fontFamily:"Cutive Mono",topbarBackground:"rgba(255, 255, 255, 0.81)",topbarText:"rgba(0, 0, 0, 1)",sequenceBackground:"rgba(0, 0, 0, 1)",sequenceText:"#ffffff",buttonBackground:"rgba(159, 247, 71, 1)",buttonText:"rgba(0, 0, 0, 1)",assetsBackground:"rgba(255, 255, 255, 0.1)",assetsFill:"rgba(159, 247, 71, 1.00)",sequenceBoldText:"#ffffff",inventoryBackground:"rgba(159, 247, 71, 0.4)"}},te={name:"green",styles:{textStyle:{type:"sans"},animations:{sequence:"unzoom",objectModal:"zoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(11, 168, 145, 1.00)"},sequenceBoldLock:!1,sequenceRadius:1,sequenceBorderColor:"#ffffff",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(196, 230, 6, 1)",fontFamily:"Catamaran",topbarBackground:"rgba(92, 127, 21, 1.00)",topbarText:"rgba(23, 33, 1, 1)",sequenceBackground:"rgba(255, 255, 255, 1)",sequenceText:"rgba(23, 33, 1, 1.00)",buttonBackground:"rgba(92, 127, 21, 1.00)",buttonText:"#ffffff",assetsBackground:"rgba(92, 127, 21, 0.25)",assetsFill:"rgba(92, 127, 21, 1.00)",sequenceBoldText:"rgba(11, 168, 145, 1.00)",inventoryBackground:"rgba(21, 127, 112, 0.2)"}},ne={name:"horror",styles:{textStyle:{type:"sans"},animations:{sequence:"zoom",objectModal:"rotateZoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(252, 1, 32, 1.00)"},sequenceBoldLock:!1,sequenceRadius:1,sequenceBorderColor:"#ffffff",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(0, 0, 0, 1)",fontFamily:"Neucha",topbarBackground:"rgba(79, 7, 16, 1.00)",topbarText:"rgba(252, 1, 32, 1.00)",sequenceBackground:"rgba(141, 13, 30, 1)",sequenceText:"rgba(255, 255, 255, 1)",buttonBackground:"rgba(252, 1, 32, 1)",buttonText:"#ffffff",assetsBackground:"rgba(79, 7, 16, 1)",assetsFill:"rgba(252, 1, 32, 1.00)",sequenceBoldText:"rgba(252, 1, 32, 1.00)",inventoryBackground:"rgba(139, 13, 29, 1.00)"}},ae={name:"night",styles:{textStyle:{type:"sans"},animations:{sequence:"unzoom",objectModal:"zoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(146, 184, 228, 1)"},sequenceBoldLock:!1,sequenceRadius:1,sequenceBorderColor:"rgba(1, 45, 95, 1.00)",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"rgba(249, 250, 164, 1.00)",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(6, 15, 71, 1)",fontFamily:"Catamaran",topbarBackground:"rgba(29, 35, 76, 1.00)",topbarText:"rgba(249, 250, 164, 1.00)",sequenceBackground:"rgba(1, 45, 95, 1)",sequenceText:"rgba(255, 255, 255, 1)",buttonBackground:"rgba(249, 250, 164, 1)",buttonText:"rgba(6, 15, 71, 1.00)",assetsBackground:"rgba(29, 35, 76, 1)",assetsFill:"rgba(249, 250, 164, 1.00)",sequenceBoldText:"rgba(249, 250, 164, 1.00)",inventoryBackground:"rgba(1, 45, 95, 1.00)"}},re={name:"pop",styles:{textStyle:{type:"sans"},animations:{sequence:"unzoom",objectModal:"rotateZoom",objectModalDecorator:"star",objectModalDecoratorColor:"rgba(252, 246, 158, 1)"},sequenceBoldLock:!0,sequenceRadius:1,sequenceBorderColor:"#ffffff",sequenceBorderSize:0,buttonRadius:1,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(252, 211, 1, 1)",fontFamily:"Catamaran",topbarBackground:"rgba(249, 1, 105, 1.00)",topbarText:"#ffffff",sequenceBackground:"rgba(249, 1, 105, 1)",sequenceText:"#ffffff",buttonBackground:"rgba(21, 195, 204, 1)",buttonText:"rgba(255, 255, 255, 1)",assetsBackground:"rgba(252, 211, 1, 1.00)",assetsFill:"rgba(249, 1, 105, 1.00)",sequenceBoldText:"#ffffff",inventoryBackground:"rgba(252, 246, 158, 1.00)"}},oe={name:"space",styles:{textStyle:{params:{color:"rgba(50, 140, 246, 1)",size:5,color2:"rgba(50, 140, 246, 1.00)"},type:"glow"},animations:{sequence:"unzoom",objectModal:"zoom",objectModalDecorator:"sans"},sequenceBoldLock:!1,sequenceRadius:0,sequenceBorderColor:"rgba(255, 255, 255, 1)",sequenceBorderSize:0,buttonRadius:0,buttonBorderColor:"#ffffff",buttonBorderSize:0,inventoryBackgroundCustom:!1,background:"rgba(1, 13, 28, 1)",fontFamily:"Abel",topbarBackground:"rgba(188, 231, 254, 0.15)",topbarText:"rgba(188, 231, 254, 1.00)",sequenceBackground:"rgba(249, 249, 249, 0)",sequenceText:"#ffffff",buttonBackground:"rgba(188, 231, 254, 0.15)",buttonText:"#ffffff",assetsBackground:"rgba(1, 13, 28, 1.00)",assetsFill:"rgba(255, 255, 255, 0.7)",sequenceBoldText:"rgba(167, 225, 253, 1)",inventoryBackground:"rgba(188, 231, 254, 0.15)"}},ce=function(e){var t=e.color,n=void 0===t?"#000":t,a=e.size,r=void 0===a?1:a,o="".concat(.02*r,"em"),c="".concat(.06*r,"em");return{textShadow:"\n      0 -".concat(o," 0 ").concat(n,",\n      0 -").concat(o," 0 ").concat(n,",\n      0 ").concat(o," 0 ").concat(n,",\n      0 ").concat(o," 0 ").concat(n,",\n      -").concat(o," 0 0 ").concat(n,",  \n      ").concat(o," 0 0 ").concat(n,",\n      -").concat(o," 0 0 ").concat(n,",\n      ").concat(o," 0 0 ").concat(n,",\n      -").concat(o," -").concat(o," 0 ").concat(n,",  \n      ").concat(o," -").concat(o," 0 ").concat(n,",\n      -").concat(o," ").concat(o," 0 ").concat(n,",\n      ").concat(o," ").concat(o," 0 ").concat(n,",\n      -").concat(o," ").concat(c," 0 ").concat(n,",\n      0 ").concat(c," 0 ").concat(n,",\n      ").concat(o," ").concat(c," 0 ").concat(n)}},le=function(e){var t=e.color,n=void 0===t?"#000":t,a=e.color2,r=void 0===a?"#fff":a,o=e.size,c=void 0===o?1:o;return{textShadow:"\n    0 0 ".concat(.05*c,"em ").concat(r,",\n    0 0 ").concat(.1*c,"em ").concat(n)}},ie=function(e){var t=e.color,n=void 0===t?"#000":t,a=e.size,r=void 0===a?1:a;return{textShadow:"".concat(n," ").concat(.04*r,"em ").concat(.03*r,"em 0")}},se=function(e){var t=e.color,n=void 0===t?"#000":t,a=e.size,r="".concat(.05*(void 0===a?1:a),"em");return{textShadow:"".concat(n," ").concat(r," ").concat(r," 0")}},ue=function(e){for(var t=e.color,n=void 0===t?"#000":t,a=e.size,r=[],o=void 0===a?1:a;o>0;)r.push(o),o-=.25;return{textShadow:r.map((function(e){return"".concat(e,"px ").concat(e,"px ").concat(n)})).join(",")}},de=Object.entries(a).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),me=A,fe=function(e,t){var n,a=e.themes.find((function(e){return e.identifier===t}))||{},o=de.find((function(e){return e.name===a.name}))||A,c=a.styles?a.styles:{},l=Object(d.a)({},o.styles,{},c),i=(n=l.textStyle)&&n.type&&"function"===typeof r[n.type]?r[n.type](n.params||{}):{};return{sequenceStyles:l,textStyle:i,sequence:{background:l.sequenceBackground,color:l.sequenceText,fontFamily:l.fontFamily,borderRadius:1.5*(void 0===l.sequenceRadius?1:l.sequenceRadius)+"em",border:"".concat(l.sequenceBorderSize||"0","px ").concat(l.sequenceBorderColor||"#fff"," solid")},button:Object(d.a)({background:l.buttonBackground,color:l.buttonText,fontFamily:l.fontFamily,borderRadius:1.7*(void 0===l.buttonRadius?1:l.buttonRadius)+"em",outline:"".concat(l.buttonBorderSize||"0","px ").concat(l.buttonBorderColor||"#fff"," solid")},i)}},be=function(e){var t=e.value,n=e.size,a=void 0===n?4:n,r=e.styles,o=void 0===r?{}:r;return Array.from({length:a}).map((function(e,n){return c.a.createElement("div",{key:"charcode-"+n,className:"sequence-content",style:{margin:2,width:"2em",height:"2em",overflow:"hidden"}},c.a.createElement("div",{style:Object(d.a)({},o.sequence,{overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",border:"none"})},t.slice(n,n+1)||"_"))}))},ge=function(e){var t=e.resetCode,n=e.puzzle,a=e.styles,r=e.onCodeEntered,l=Object(o.useState)(!1),i=Object(s.a)(l,2),u=i[0],m=i[1],f=Object(o.useState)(!1),b=Object(s.a)(f,2),y=b[0],v=b[1],p=Object(o.useState)(""),E=Object(s.a)(p,2),h=E[0],O=E[1],S=function(e){O((h+e).slice(0,n.size))},j=function(){O(h.slice(0,-1))};Object(o.useEffect)((function(){m(h.length===n.size),v(h.length>0)}),[h]),Object(o.useEffect)((function(){t||(O(""),v(!1),m(!1))}),[t]);var k="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),x=Object(d.a)({},a.button,{outline:"none"});return c.a.createElement("div",{className:"puzzle-renderer",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"}},c.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginBottom:10,flexGrow:1}},c.a.createElement(be,{value:h,size:n.size,styles:a})),"numeric"===n.kind&&c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{style:x,onClick:function(){return S("1")}},"1"),c.a.createElement("button",{style:x,onClick:function(){return S("2")}},"2"),c.a.createElement("button",{style:x,onClick:function(){return S("3")}},"3")),c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{style:x,onClick:function(){return S("4")}},"4"),c.a.createElement("button",{style:x,onClick:function(){return S("5")}},"5"),c.a.createElement("button",{style:x,onClick:function(){return S("6")}},"6")),c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{style:x,onClick:function(){return S("7")}},"7"),c.a.createElement("button",{style:x,onClick:function(){return S("8")}},"8"),c.a.createElement("button",{style:x,onClick:function(){return S("9")}},"9")),c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{disabled:!y,style:Object(d.a)({},x,{opacity:y?1:.5}),onClick:function(){return O("")}},c.a.createElement(g.a,{name:"close",style:{margin:0,display:"flex",width:10.5,justifyContent:"center"}})),c.a.createElement("button",{style:x,onClick:function(){return S("0")}},"0"),c.a.createElement("button",{disabled:!y,style:Object(d.a)({},x,{opacity:y?1:.5}),onClick:function(){return j()}},c.a.createElement(g.a,{name:"angle left",style:{margin:0,display:"flex",width:10.5,justifyContent:"center"}})))),"alpha"===n.kind&&c.a.createElement(o.Fragment,null,[0,1,2,3].map((function(e){return c.a.createElement("div",{key:"alphakeys-"+e,className:"pad-buttons small",style:{display:"flex",alignItems:"center",justifyContent:"center"}},k&&k.slice(6*e,6*e+6).map((function(e){return c.a.createElement("button",{key:"alphakey-"+e,style:x,onClick:function(){return S(e)}},e)})))})),c.a.createElement("div",{className:"pad-buttons",style:{display:"flex",alignItems:"center",justifyContent:"center"}},c.a.createElement("button",{disabled:!y,style:Object(d.a)({},x,{opacity:y?1:.5}),onClick:function(){return O("")}},c.a.createElement(g.a,{name:"trash",style:{margin:0,display:"flex",width:10.5,justifyContent:"center"}})),c.a.createElement("button",{style:Object(d.a)({},x,{width:46}),onClick:function(){return S(k.slice(-2)[0])}},k.slice(-2)[0]),c.a.createElement("button",{style:Object(d.a)({},x,{width:46}),onClick:function(){return S(k.slice(-1)[0])}},k.slice(-1)[0]),c.a.createElement("button",{disabled:!y,style:Object(d.a)({},x,{opacity:y?1:.5}),onClick:function(){return j()}},c.a.createElement(g.a,{name:"angle left",style:{margin:0,display:"flex",width:10.5,justifyContent:"center"}})))),c.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:10}},c.a.createElement("button",{disabled:!u,style:Object(d.a)({},a.button,{opacity:u?1:.5}),onClick:function(){r&&r(h)}},c.a.createElement(g.a,{name:"caret right",style:{margin:0}}))))},ye=n(250),ve=n(352),pe=n(196),Ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("string"===typeof e&&e.startsWith("#")){var n=e.slice(1);if(3===n.length&&(n+=n),6===n.length&&(n+="ff"),8===n.length&&/[0-9a-fA-F]{8}/g.test(n)){var a=n.match(/.{1,2}/g),r=parseInt(a[0],16),o=parseInt(a[1],16),c=parseInt(a[2],16),l=t||(parseInt(a[3],16)/255).toFixed(2);return"rgba(".concat(r,", ").concat(o,", ").concat(c,", ").concat(l,")")}}return e},he=function(e){var t=Math.round(e).toString(16);return 1===t.length?"0"+t:t},Oe=function(e){if("string"===typeof e&&e.startsWith("rgb")){var t=e;t.startsWith("rgba")||(t+=",1");var n=t.match(/[.\d]+/g).map((function(e){return+e})),a=Object(s.a)(n,4);return{r:a[0],g:a[1],b:a[2],a:a[3]}}return e},Se=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t)return n?"#000000":"black";if("string"===typeof t)return n&&!t.startsWith("#")?e(Oe(t),!0):t;var a=t.r,r=t.g,o=t.b,c=t.a;if(n){var l=Math.round(255*c);return"#".concat(he(a)).concat(he(r)).concat(he(o)).concat(1!==c?he(l):"")}return"rgba(".concat(a,", ").concat(r,", ").concat(o,", ").concat(c,")")},je=function(e){var t=e.duration,n=e.styles,a=void 0===n?{}:n,r=e.onTimesUp,l=e.isPreview,i=e.isPaused,u=Object(o.useState)(t||30),d=Object(s.a)(u,2),m=d[0],f=d[1],b=Object(o.useRef)(null);return Object(o.useEffect)((function(){t&&f(t)}),[t]),Object(o.useEffect)((function(){if(!l)return b.current=setInterval((function(){i||f((function(e){return e-1}))}),1e3),function(){clearInterval(b.current)}}),[t,l,i]),Object(o.useEffect)((function(){m<=0&&(clearInterval(b.current),r&&r())}),[m]),c.a.createElement("div",{style:{width:70,height:70,margin:"1em auto",fontSize:"1em",position:"relative"}},c.a.createElement(pe.a,{counterClockwise:!0,value:100/t*m,strokeWidth:10,styles:{path:{stroke:a.color},trail:{stroke:Ee(Se(a.color,!0),.3)}}}),c.a.createElement("p",{style:{position:"absolute",top:0,left:0,width:70,height:70,display:"flex",justifyContent:"center",alignItems:"center",padding:0,margin:0,fontSize:"1em"}},m&&m>0?m:"0"))},ke=n(362),xe=function(e){var t,n=e.svg;return c.a.createElement("div",{className:"fallback",dangerouslySetInnerHTML:{__html:(t=n,C.a.sanitize(t))}})},qe=function(e){var t=e.icon,n=e.className,a=void 0===n?"":n,r=e.style,o=void 0===r?{}:r,l=t&&t.split("svg+xml,"),i=l&&2===l.length?decodeURIComponent(l[1]):t;return c.a.createElement(ke.a,{src:i&&!i.startsWith("<svg ")?i:"",className:a,style:o,fallback:function(){return c.a.createElement(xe,{svg:i})}})},we=function(e){var t=e.buttons,n=e.onTimerNext,a=e.ButtonRenderer,r=e.buttonContaineStyle,l=e.timerChoice,i=e.timerStatus,u=Object(o.useState)({opacity:1}),m=Object(s.a)(u,2),f=m[0],b=m[1],g=Object(o.useState)(null),y=Object(s.a)(g,2),v=y[0],p=y[1],h=Object(E.d)(Object(d.a)({from:{opacity:1,transform:"scale(1)"},config:{duration:800,easing:E.c.easeOutCubic},onRest:function(e){0===e.value.opacity&&(l.next?n({next:l.next},!0):n(t[0].hasOwnProperty("originalIndex")?t.find((function(e){return e.originalIndex===l.idx})):t[l.idx],!0))}},f));return Object(o.useEffect)((function(){if(null!==l){"stop"===i&&p(l);var e=document.getElementById("the-good-choice");e&&e.scrollIntoView&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}),b({opacity:0,transform:"scale(0)"})}}),[l]),c.a.createElement(o.Fragment,null,t.map((function(e,t){var n=e.hasOwnProperty("originalIndex")?e.originalIndex:t,o={};return v&&e.originalIndex!==v.idx&&(o.opacity=0,o.transform="scale(0)"),c.a.createElement(E.a.div,{key:"choice-"+n,style:Object(d.a)({},null!==l&&l.idx!==n?h:{},{},r)},c.a.createElement(a,{id:null!==l&&l.idx===n?"the-good-choice":void 0,style:o,item:e}))})))},Ce=(n(335),function(e){var t=e.onObjectSelected,n=e.objects,a=e.story,r=e.styles,l=e.sequence,i=e.timerChoice,u=e.timerStatus,m=e.prepareNextSequence,b=Object(o.useMemo)((function(){var e,t=l.puzzle,r=Object.entries(a.assets||{}).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})).filter((function(e){return"object"===e.kind})),o=Object(f.a)(new Set(r.map((function(e){return e.tags})).reduce((function(e,t){return e.concat(t)}),[]))),c=(t.onlyTags||[]).filter((function(e){return o.indexOf(e)>=0}));switch(t.inventoryStrategy){case"not-in":e=r.filter((function(e){return-1===(n||[]).indexOf(e.id)}));break;case"added":e=t.codes.map((function(e){return r.find((function(t){return t.id===e.value}))}));break;default:e=(n||[]).map((function(e){return a.assets[e]}))}return c&&c.length>0&&(e=e.filter((function(e){return L(e,c,t.tagStrategy,o)}))),l.randomOrder?M(e):e.map((function(e,t){return Object(d.a)({},e,{originalIndex:t})}))}),[l,n]);return c.a.createElement(D.Consumer,null,(function(e){return c.a.createElement(o.Fragment,null,b&&b.length>0?c.a.createElement("div",{className:"list-objects-container choice-object",style:{display:"flex",flexWrap:"wrap",justifyContent:"center",maxWidth:500}},c.a.createElement(we,{buttons:b,onTimerNext:m,timerChoice:i,timerStatus:u,buttonContaineStyle:{margin:"complete"===l.puzzle.displayKind?"3px .5em":5,width:"complete"===l.puzzle.displayKind?"100%":120},ButtonRenderer:function(e){var n=e.item,a=e.id,i=e.style;return c.a.createElement("div",{id:a,style:Object(d.a)({background:"none",boxShadow:"none",fontSize:"1.4em"},i),onClick:function(){return t(n.id)}},c.a.createElement("div",{style:Object(d.a)({},r.button,{borderRadius:r.sequenceStyles.buttonRadius+"em",outline:"none"})},c.a.createElement("div",{className:["puzzle-object","win-object-card",l.puzzle.displayKind].join(" "),style:{position:"relative",padding:10}},"complete"===l.puzzle.displayKind?c.a.createElement("div",{style:{display:"flex",width:"100%"}},c.a.createElement(qe,{icon:n.icon,style:{fill:r.button.color,stroke:r.button.color,margin:0,display:"flex",alignItems:"center"}}),c.a.createElement("div",{className:"win-object-content"},c.a.createElement("div",{className:"win-object-name",style:Object(d.a)({fontFamily:r.button.fontFamily,color:r.button.color},r.textStyle)},T(n.label).trim()),c.a.createElement("div",{className:"win-object-desc",style:Object(d.a)({fontFamily:r.button.fontFamily,color:r.button.color},r.textStyle)},T(F(n.desc)).trim()))):c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"win-object-name",style:Object(d.a)({fontFamily:r.button.fontFamily,color:r.button.color},r.textStyle)},T(n.label).trim()),c.a.createElement(qe,{icon:n.icon,style:{fill:r.button.color,stroke:r.button.color,margin:0,display:"flex",flexGrow:1,alignItems:"center"}})))))}})):c.a.createElement("button",{style:Object(d.a)({},r.button,{outline:"none"})},c.a.createElement("i",null,e.OBJECT_SELECTOR)))}))}),Re=n(207),Te=(n(632),{scrollable:!1,scrollableUp:!1,scrollableDown:!1,scrollbarSize:0,scrollbarPos:0}),Be="marker",ze=Object(o.forwardRef)((function(e,t){var n=e.children,a=e.style,r=void 0===a?{}:a,l=e.containerStyles,i=void 0===l?{}:l,u=e.wrapperStyles,m=void 0===u?{}:u,f=e.color,b=void 0===f?"#fff":f,g=e.horizontalScrollPadding,y=void 0!==g&&g,v=e.verticalScrollPadding,p=void 0===v||v,E=e.withArrows,h=void 0!==E&&E,O=e.allowScroll,S=void 0===O||O,j=e.onChangeHeight,k=void 0===j?null:j,x=e.scrollbarStyle,q=void 0===x?Be:x,w=Object(o.useState)(Te),C=Object(s.a)(w,2),R=C[0],T=C[1],B=Object(o.useCallback)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t[1];k&&k(Math.ceil(a))}),[k]),z=Object(Re.a)(),N=z.height,I=z.ref,M=Object(Re.a)(),F=M.height,L=M.ref,_=Object(Re.a)({onResize:B}),D=_.height,A=_.ref;Object(o.useLayoutEffect)((function(){N&&F&&D&&H()}),[N,F,D]);var U=Object(o.useCallback)((function(){var e=I.current,t=R.scrollable?30:0,n=F*(N/(D+t)),a=e.scrollTop/(e.scrollHeight-e.clientHeight)*(F-n);T({scrollable:!0,scrollbarSize:n,scrollableUp:e.scrollTop>0,scrollableDown:e.scrollTop<e.scrollHeight-e.clientHeight-1,scrollbarPos:a})}),[L,I,D,N,F]),H=Object(o.useCallback)((function(){I.current&&(S&&F*(N/D)<F?U():T(Te))}),[I,R,U,S,D,F]),P=Object(o.useCallback)((function(){var e=I.current;e&&(e.scrollTop=0),T(Te)}),[I,H]);Object(o.useImperativeHandle)(t,(function(){return{getScrollboxHeight:function(){return I.current&&I.current.children&&I.current.children.length>0?I.current.children[0].scrollHeight:0},resetScroll:P}}),[H,P]),Object(o.useLayoutEffect)((function(){var e=I.current;return e&&e.addEventListener("scroll",U),window.addEventListener("resize",H),function(){e&&e.removeEventListener("scroll",U),window.removeEventListener("resize",H)}}),[H,U]);var W=Object(o.useMemo)((function(){if(S){if(R.scrollableDown&&R.scrollableUp)return"mask-scroll";if(R.scrollable&&R.scrollableUp)return"mask-scroll";if(R.scrollable&&R.scrollableDown)return"mask-scroll"}return""}),[S,R]);return c.a.createElement("div",{ref:t,className:"story-scrollbox-container",style:Object(d.a)({display:"flex",flexDirection:"column",justifyContent:"center",position:"relative",padding:".5em"},i)},R.scrollable&&h?c.a.createElement("div",{className:"arrow-top",style:{opacity:R.scrollableUp?1:.2,borderBottom:"10px solid ".concat(b)}}):null,c.a.createElement("div",{style:Object(d.a)({},r),className:"scrollbox-content ".concat(W),ref:I},c.a.createElement("div",{ref:A,style:Object(d.a)({paddingTop:R.scrollable&&p?15:0,paddingBottom:R.scrollable&&p?15:0,paddingLeft:R.scrollable&&y?15:0,paddingRight:R.scrollable&&y?15:0},m)},n)),R.scrollable&&h?c.a.createElement("div",{className:"arrow-bottom",style:{opacity:R.scrollableDown?1:.2,borderTop:"10px solid ".concat(b)}}):null,c.a.createElement("div",{ref:L,className:["scrollbox-bar",q,R.scrollable?"scrollable":""].join(" "),style:{borderColor:b}},R.scrollable?c.a.createElement("div",{className:"scrollbox-bar-tick",style:{top:R.scrollbarPos||0,height:R.scrollbarSize||0,background:b}}):null))})),Ne=(n(643),function(e){var t=getComputedStyle(e),n=t.marginTop,a=t.marginBottom;return parseFloat(n)+parseFloat(a)}),Ie={content:{minHeight:"20%",maxHeight:"100%"},actions:{minHeight:"50%",maxHeight:"100%"}},Me=Object(o.forwardRef)((function(e,t){var n=Object(o.useRef)(),a=Object(o.useRef)(),r=Object(o.useRef)();Object(o.useImperativeHandle)(t,(function(){return{resetScrolls:function(){a.current&&a.current.resetScroll(),r.current&&r.current.resetScroll()}}}));var l=Object(o.useState)(0),i=Object(s.a)(l,2),u=i[0],d=i[1],m=(Object(o.useDeferredValue)(u),Object(o.useState)(Ie)),f=Object(s.a)(m,2),b=f[0],g=f[1];return Object(o.useLayoutEffect)((function(){var t=a.current&&a.current.getScrollboxHeight?a.current.getScrollboxHeight():0,o=r.current&&r.current.getScrollboxHeight?r.current.getScrollboxHeight():0,c=0,l=0;e.content&&t>0&&(c+=t||0,l+=Ne(n.current.children[0])),o>0&&(c+=o||0,l+=Ne(n.current.children[1]));var i=n.current.clientHeight-l;e.content&&g(c<i?{content:{minHeight:"auto",maxHeight:"100%"},actions:{minHeight:"auto",maxHeight:"80%"}}:o<.5*i?{content:{minHeight:"20%",maxHeight:"100%"},actions:{minHeight:"auto",maxHeight:"50%"}}:t<.5*i?{content:{minHeight:"auto",maxHeight:"50%"},actions:{minHeight:"20%",maxHeight:"100%"}}:{content:{minHeight:"30%",maxHeight:"50%"},actions:{minHeight:"30%",maxHeight:"50%"}})}),[e.content]),c.a.createElement("div",{ref:n,className:"story-layout-container",style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",position:"relative"}},c.a.createElement("div",{className:"story-content-container",style:e.content?b.content:{height:0,minHeight:0,overflowY:"hidden",flexGrow:0}},c.a.createElement(ze,{ref:a,color:e.contentColor,containerStyles:e.contentStyles||{},scrollbarStyle:e.contentScrollbarStyle},e.content||null)),c.a.createElement("div",{className:"story-actions-container",style:e.content?b.actions:{flexGrow:1}},c.a.createElement(ze,{ref:r,color:e.actionsColor,containerStyles:e.actionsStyles||{},scrollbarStyle:e.actionsScrollbarStyle,onChangeHeight:function(e){d(e)},withArrows:!0},e.actions||null)))}));n(644);function Fe(){var e=Object(p.a)(["\n    b, strong {\n      color: ",";\n    }\n  "]);return Fe=function(){return e},e}var Le={position:"absolute",right:".3em",top:".3em",zIndex:1,opacity:.8},_e={padding:".3em .35em",fontSize:".8em",margin:0},De=function(e){var t=e.wrapper,n=e.image,a=Object(o.useState)({}),r=Object(s.a)(a,2),l=r[0],i=r[1];return Object(o.useEffect)((function(){t&&i({width:t.offsetWidth||"100%",height:t.offsetHeight||"100%"})}),[t]),c.a.createElement(ye.a,null,c.a.createElement("div",{style:Object(d.a)({},l,{display:"flex",justifyContent:"center",alignItems:"center"})},c.a.createElement("img",{src:n,alt:"",style:{width:"100%",height:"auto"}})))},Ae=function(e){var t=Object(o.useRef)(),n=e.styles,a=e.image,r=e.onClose;return c.a.createElement("div",{className:"magnifier-container",ref:t,style:{position:"absolute",zIndex:90,top:0,left:0,right:0,bottom:0,background:"#fff"}},c.a.createElement("div",{style:{width:"100%",height:"100%",background:n&&n.sequenceStyles?n.sequenceStyles.background:"#000",display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(ye.b,{initialScale:1},(function(){return c.a.createElement(De,{wrapper:t?t.current:null,image:a})})),c.a.createElement("div",{style:Object(d.a)({},Le,{background:n&&n.sequenceStyles?n.sequenceStyles.background:"#000",borderRadius:n.sequenceStyles.buttonRadius+"em"})},c.a.createElement("button",{style:Object(d.a)({},n.button,{},_e,{width:"2em",height:"2em",outline:"none",textShadow:"none"}),onClick:r},c.a.createElement(g.a,{name:"close",style:{margin:0}})))))},Ue=function(e){var t=e.story,n=e.timerChoice,a=e.timerStatus,r=e.choices,o=e.styles,l=e.convertVariables,i=e.prepareNextSequence,s=e.undo;return r.length>0?c.a.createElement(we,{buttons:r,onTimerNext:i,timerChoice:n,timerStatus:a,ButtonRenderer:function(e){var n=e.item,a=e.id,r=e.style,s=(n.themeId?fe(t,n.themeId):o).button,u=(s.outline||"").split(" ").find((function(e){return e.endsWith("px")})),m=Math.ceil((u?parseInt(u):0)*(2/3));return c.a.createElement("button",{id:a,style:Object(d.a)({},s,{},r,{margin:"calc(".concat(m,"px + 0.25em) calc(").concat(m,"px + .5em)")}),onClick:function(){return i(n)}},c.a.createElement("div",{dangerouslySetInnerHTML:{__html:N(z(l(n.content)))}}))}}):c.a.createElement("button",{style:Object(d.a)({},o.button),onClick:s},c.a.createElement(g.a,{name:"caret left",style:{margin:0}}))},He=Object(o.forwardRef)((function(e,t){var n=e.story,a=e.gameData,r=e.path,l=e.routineExit,i=e.randomSeeds,u=e.sequence,f=e.gotoSequence,b=e.playClickSound,y=e.theme,v=e.styles,p=e.showStats,O=e.addReview,S=e.canAddReview,j=e.undo,x=e.canUndo,q=e.onReplay,w=e.reducedViewport,C=void 0!==w&&w,R=e.canShowStats,T=e.isPreview,B=void 0!==T&&T,I=e.isPaused,M=void 0!==I&&I,F=e.visible,L=void 0===F||F,_=e.futureSequence,A=Object(o.useState)(!0),U=Object(s.a)(A,2),H=U[0],P=U[1],W=Object(o.useState)(null),V=Object(s.a)(W,2),G=V[0],Y=V[1],J=Object(o.useState)(null),K=Object(s.a)(J,2),Z=K[0],X=K[1],$=Object(o.useRef)(null),Q=Object(o.useRef)(null),ee=Object(E.e)(),te=Object(E.d)({from:{opacity:B||r.length>1?1:0},to:{opacity:1,translate:0},config:{duration:350,easing:E.c.easeOutCubic},ref:ee});Object(o.useEffect)((function(){$.current="run",X(null),Y(null)}),[u,a,r]);var ne=Object(o.useRef)();Object(o.useLayoutEffect)((function(){u&&L&&(H&&u.id===_||B)&&ee.start({opacity:1,translate:0})}),[u,L,_]);var ae=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];("block"!==$.current||t)&&($.current="stop",b(),P(!1),ee.start({opacity:0,translate:-100,onRest:function(){X(null),ee.set({opacity:0,translate:100}),ne.current&&ne.current.resetScrolls(),Q.current=Math.random();var t=e||{},n=t.next,a=t.actions,r=t.conditions;f(n,a,r),P(!0)}}))},re=function(){$.current="stop",X(null),ee.set({opacity:0,translate:100}),ne.current&&ne.current.resetScrolls(),Q.current=Math.random(),P(!0),j()};Object(o.useImperativeHandle)(t,(function(){return{undo:re}}));var oe=Object(d.a)({opacity:te.opacity,transform:te.translate.to((function(e){return k.getAnimationStyle(y.styles.animations?y.styles.animations.sequence:null)(e)}))},v.textStyle),ce=function(e){var t=u.puzzle&&u.puzzle.codes?u.puzzle.codes.find((function(t){return t.value.toUpperCase()===e.toUpperCase()})):null;t?ae({next:t.next}):u.puzzle&&u.puzzle.defaultNext?ae({next:u.puzzle.defaultNext}):console.log("No link defined for this code. Check your sequence !")},le=function(e){var t=u.puzzle&&u.puzzle.codes?u.puzzle.codes.find((function(t){return t.value===e})):null,n=u.puzzle.toggleStrategy,a="in"===u.puzzle.inventoryStrategy?"sub":"add",r=[];t?("yes"!==n&&"listed"!==n||(r=[{kind:"object",params:{target:e,modifier:a}}]),ae({next:t.next,actions:r})):u.puzzle&&u.puzzle.defaultNext?("yes"!==n&&"not-listed"!==n||(r=[{kind:"object",params:{target:e,modifier:a}}]),ae({next:u.puzzle.defaultNext,actions:r})):console.log("No link defined for this code. Check your sequence !")},ie=function(e){var t=e.icon,n=e.big,a=e.label,r=(e.width,Object(m.a)(e,["icon","big","label","width"])),o=(v.button.outline||"").split(" ").find((function(e){return e.endsWith("px")})),l=Math.ceil((o?parseInt(o):0)*(2/3));return c.a.createElement("button",Object.assign({style:Object(d.a)({},v.button,{padding:n?".7em 1em":".5em 1em",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",borderRadius:v.sequenceStyles.buttonRadius+"em",width:C?n?"5em":"6em":"18vmin",minWidth:n?70:64,margin:"calc(".concat(l,"px + 0.5em) calc(").concat(l,"px + .3em)")})},r),c.a.createElement(g.a,{name:t,style:{fontSize:n?"1.8em":"1.4em",margin:"0 0 5px"}}),"  ",c.a.createElement("span",{style:{fontSize:n?"1em":".8em"}},a))},se=function(){q?q():ae(u)},ue=function(e){var t=e.strings;return c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(ie,{id:"bt-replay",icon:"repeat",disabled:!p,onClick:se,label:t.RETRY}),O&&S&&c.a.createElement(o.Fragment,null,n&&n.socialClubData&&n.socialClubData.allowReviews?c.a.createElement(ie,{id:"bt-rate",disabled:!p,icon:"star",onClick:O,label:t.REVIEWS,big:!0}):c.a.createElement(ie,{id:"bt-rate",disabled:!p,icon:"plus",onClick:O,label:t.MORE_INFO,big:!0})),R&&c.a.createElement(ie,{id:"bt-stats",icon:"chart pie",disabled:!p,onClick:p,label:t.STATS}))},de=function(e){var t=e.strings;return c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(ie,{id:"bt-replay",icon:"repeat",disabled:!p,onClick:se,label:t.RETRY}),j&&x&&c.a.createElement(ie,{id:"bt-lastchoice",icon:"angle double left",disabled:!p,onClick:re,label:t.BACK,big:!0}),R&&c.a.createElement(ie,{id:"bt-stats",icon:"chart pie",disabled:!p,onClick:p,label:t.STATS}))},me=u.image&&n.images&&n.images[u.image.id]||{},fe=me.urlLocal||me.url,be={src:fe,size:u&&u.image&&u.image.size?u.image.size:"medium",circular:!!(u&&u.image&&u.image.kind)&&"circular"===u.image.kind,rounded:!0},ye=fe&&c.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},c.a.createElement("div",{style:{position:"relative",margin:"auto"}},c.a.createElement(h.a,Object.assign({style:Object(d.a)({margin:".5em",maxWidth:270,maxHeight:u.puzzle?160:"inherit"},u.puzzle?{width:"auto"}:{},{},be.circular?{aspectRatio:"1/1"}:{})},be)),!G&&u.image&&u.image.allowZoom&&c.a.createElement("div",{style:Object(d.a)({},Le,{background:v&&v.sequenceStyles?v.sequenceStyles.background:"#000",borderRadius:v.sequenceStyles.buttonRadius+"em"})},c.a.createElement("button",{style:Object(d.a)({},v.button,{},_e,{width:"2em",height:"2em",outline:"none",textShadow:"none"}),onClick:function(){return Y(be.src)}},c.a.createElement(g.a,{name:"zoom-in",fitted:!0}))))),pe=function(e){for(var t,r=/<span class="ql-moikivar"([^<]+)<\/span>/gim,o=/data-var-id="([A-Za-z0-9-]+)" data-var-op="([a-z]+)"/,c=[],l=a.counters||[],s=a.textvars||[],u=0,d=function(){var e=t[0].match(o);if(e&&e.length>1){var a=l.find((function(t){return t.id===e[1]}))||n.counters[e[1]],r=s.find((function(t){return t.id===e[1]}))||n.textvars[e[1]],d=e[2]||"value",m="";if(a)switch(d){case"percent":var f=a.value||0,b=n.counters[a.id];m=Math.round((f-b.min)/(b.max-b.min)*100)+"%";break;default:m=void 0!==a.value?a.value.toString():a.defaultValue.toString()}else if(r){var g=n.textvars[r.id];switch(d){case"random":g.values&&g.values.length>0?(m=g.values[Math.floor(i[u]*g.values.length)].text,++u>i.length&&(u=0)):m=r.name;break;default:if(m=r.name,g&&g.values&&g.values.length>0){var y=g.values.find((function(e){return e.id===r.value}));m=y?y.text:g.values[0].text}}}c.push({from:t[0],to:m})}};null!==(t=r.exec(e));)d();for(var m=e,f=0;f<c.length;++f)m=m.replace(c[f].from,c[f].to);return m},Ee=ve.a.div(Fe(),y.styles.sequenceBoldText||y.styles.sequenceText),he=function(){if("stop"!==$.current){$.current="block";var e=u.timer,t=e.strategy,n=e.next;if("other"===t)X({idx:-1,next:n});else{var a=0;u.choices&&u.choices.length>0&&"last"===t&&(a=u.choices.length-1),X({idx:a})}}},Oe=Object(o.useMemo)((function(){return!u.noContent||u.timer&&u.timer.active}),[u]);return c.a.createElement(D.Consumer,null,(function(e){return c.a.createElement(o.Fragment,null,c.a.createElement(E.a.div,{className:"sequence",style:Object(d.a)({},oe,{display:L?"flex":"none"})},u&&c.a.createElement(Me,{ref:ne,contentStyles:Object(d.a)({},v.sequence,{},Oe?{}:{background:"none",borderRadius:0,border:"none"}),contentColor:y.styles.sequenceText,actionsStyles:u.puzzle&&"object"===u.puzzle.kind?Object(d.a)({},v.sequence,{background:(v.sequenceStyles.inventoryBackground?v.sequenceStyles.inventoryBackground:v.sequenceStyles.assetsBackground)||v.sequenceStyles.sequenceBackground}):{},actionsColor:v.button?v.button.background:void 0,content:!u.noContent||u.image||u.timer&&u.timer.active?c.a.createElement("div",{className:"sequence-content"},Oe?c.a.createElement(o.Fragment,null,u.image&&u.image.isBefore&&ye,u.timer&&u.timer.active&&c.a.createElement(je,{key:"timer-"+Q.current,isPaused:M,duration:u.timer.duration,styles:v.sequence,onTimesUp:he,isPreview:B}),u.final&&u.hasOwnProperty("routineExitLabel")?c.a.createElement("div",{dangerouslySetInnerHTML:{__html:N(z("".concat(u.routineExitLabel?"<b>"+u.routineExitLabel+"</b><br/>":"","<i>[").concat(e.END_OF_ROUTINE,"]</i>")))}}):c.a.createElement(o.Fragment,null,u.routineId?c.a.createElement("div",{dangerouslySetInnerHTML:{__html:N(z("<i>".concat(e.START_OF_ROUTINE,"<br/><b>").concat(n.routines[u.routineId].label,"</b></i>")))}}):c.a.createElement(Ee,{dangerouslySetInnerHTML:{__html:N(z(pe(u.content)))}})),u.image&&!u.image.isBefore&&ye):u.image?c.a.createElement(o.Fragment,null,c.a.createElement("div",{style:{display:"flex",justifyContent:"center",padding:0,background:"none",borderRadius:0}},c.a.createElement("div",{style:{display:"flex",justifyContent:"center",position:"relative"}},c.a.createElement(h.a,Object.assign({style:Object(d.a)({height:"auto"},be.circular?{aspectRatio:"1/1",objectFit:"cover"}:{})},be)))),!G&&u.image.allowZoom&&c.a.createElement("div",{style:Object(d.a)({},Le,{right:0,top:0,background:v&&v.sequenceStyles?v.sequenceStyles.background:"#000",borderRadius:v.sequenceStyles.buttonRadius+"em"})},c.a.createElement("button",{style:Object(d.a)({},v.button,{},_e,{width:"2em",height:"2em",outline:"none",textShadow:"none"}),onClick:function(){return Y(be.src)}},c.a.createElement(g.a,{name:"zoom-in",fitted:!0})))):null,u.final&&!u.hasOwnProperty("routineExitLabel")&&u.httplink&&c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",background:"none"}},c.a.createElement("button",{style:Object(d.a)({},v.button,{outline:"none"}),onClick:function(){return window.open(u.httplink)}},c.a.createElement(g.a,{name:"linkify"}),u.httplabel))):null,actions:c.a.createElement("div",{className:"sequence-actions"},u.puzzle?c.a.createElement(o.Fragment,null,"object"===u.puzzle.kind?c.a.createElement(Ce,{key:"puzzleobject-"+Q.current,resetCode:0===te.opacity,styles:v,puzzle:u.puzzle,onObjectSelected:le,objects:a.objects,story:n,sequence:u,isPreview:B,timerChoice:Z,timerStatus:$.current,prepareNextSequence:ae}):c.a.createElement(ge,{key:"puzzle-"+Q.current,resetCode:0===te.opacity,styles:v,puzzle:u.puzzle,onCodeEntered:ce,timerChoice:Z,timerStatus:$.current})):c.a.createElement(o.Fragment,null,u.choices&&u.choices.length>0?c.a.createElement(Ue,{key:"choices-"+Q.current,story:n,choices:u.choices,timerChoice:Z,timerStatus:$.current,styles:v,prepareNextSequence:ae,undo:re,convertVariables:pe}):c.a.createElement(o.Fragment,null,(u.final||!u.next)&&u.hasOwnProperty("routineExitLabel")&&l&&l.find((function(e){return e.from===u.id&&!!e.next}))?c.a.createElement("div",null,c.a.createElement("button",{style:v.button,onClick:function(){return ae(u)}},c.a.createElement(g.a,{name:"caret right",style:{margin:0}}))):c.a.createElement(o.Fragment,null,(u.final||!u.next)&&u.hasOwnProperty("routineExitLabel")||u.routineId?c.a.createElement("div",null):c.a.createElement(o.Fragment,null,u.final||!u.next?c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},u.isHappyEnd?c.a.createElement(ue,{strings:e}):c.a.createElement(de,{strings:e,undo:re,canUndo:x})):c.a.createElement("button",{style:v.button,onClick:function(){return ae(u)}},c.a.createElement(g.a,{name:"caret right",style:{margin:0}})))))))})),G&&c.a.createElement(Ae,{styles:v,image:G,onClose:function(){return Y(null)}}))}))}));var Pe=window.XMLHttpRequest.prototype.open,We=window.XMLHttpRequest.prototype.send,Ve=function(){window.XMLHttpRequest.prototype.open=Pe,window.XMLHttpRequest.prototype.send=We},Ge=function(e){return e&&e.localFile?e.localFile:e&&e.previews?e.previews["preview-lq-mp3"]:null},Ye=Object(o.forwardRef)((function(e,t){var a=e.sound,r=e.isLoop,l=e.onLoad,i=Ge(a),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(t.id,t.volume),r=void 0===a?1:a,l=t.playbackRate,i=void 0===l?1:l,u=t.soundEnabled,f=void 0===u||u,b=t.interrupt,g=void 0!==b&&b,y=t.onload,v=Object(m.a)(t,["id","volume","playbackRate","soundEnabled","interrupt","onload"]),p=c.a.useRef(null),E=c.a.useRef(!1),h=c.a.useState(null),O=Object(s.a)(h,2),S=O[0],j=O[1],k=c.a.useState(null),x=Object(s.a)(k,2),q=x[0],w=x[1],C=function(){"function"===typeof y&&y.call(this),E.current&&j(1e3*this.duration()),w(this)};Object(o.useEffect)((function(){return n.e(3).then(n.t.bind(null,706,7)).then((function(t){var n;E.current||(p.current=null!==(n=t.Howl)&&void 0!==n?n:t.default.Howl,E.current=!0,new p.current(Object(d.a)({src:Array.isArray(e)?e:[e],volume:r,rate:i,onload:C},v)))})),function(){E.current=!1}}),[]),c.a.useEffect((function(){p.current&&q&&w(new p.current(Object(d.a)({src:Array.isArray(e)?e:[e],volume:r,onload:C},v)))}),[JSON.stringify(e)]),c.a.useEffect((function(){q&&(q.volume(r),q.rate(i))}),[r,i]);var R=c.a.useCallback((function(e){"undefined"===typeof e&&(e={}),q&&(f||e.forceSoundEnabled)&&(g&&q.stop(),e.playbackRate&&q.rate(e.playbackRate),q.play(e.id))}),[q,f,g]),T=c.a.useCallback((function(e){q&&q.stop(e)}),[q]),B=c.a.useCallback((function(e){q&&q.pause(e)}),[q]),z=[R,{sound:q,stop:T,pause:B,duration:S}];return z}(i),f=Object(s.a)(u,2)[1];return Object(o.useImperativeHandle)(t,(function(){return f})),Object(o.useEffect)((function(){return f.sound&&(f.sound.loop(r),"loaded"===f.sound.state()&&l(i),f.sound.on("load",(function(){l(i)})),f.sound.on("fade",(function(){0===f.sound.volume()&&f.sound.stop()}))),function(){f.sound&&(f.sound.off(),f.sound.stop())}}),[f.sound,i]),c.a.createElement(o.Fragment,null)})),Je=!1,Ke=Object(o.forwardRef)((function(e,t){var n=e.sounds,a=e.onReady,r=e.onProgress,l=Object.entries(n).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]}))||[],i=Object(o.useState)([]),u=Object(s.a)(i,2),d=u[0],m=u[1],b=Object(o.useState)(!1),g=Object(s.a)(b,2),y=g[0],v=g[1],p=Object(o.useState)(0),E=Object(s.a)(p,2),h=E[0],O=E[1],S=Object(o.useRef)(null),j=Object(o.useRef)({});l.forEach((function(e){var t=e.id;j.current[t]=null}));var k=function(e){var t=x.find((function(t){return t.url===e}));t&&(t.loaded=100),O((function(e){return e+1}))};Object(o.useEffect)((function(){h===l.length&&(a(),Ve())}),[h]);var x=l.map((function(e){var t=e.sound,n=e.id;return{url:Ge(t),loaded:0,id:n}}));return Object(o.useEffect)((function(){var e;return Je=!1,e=function(e,t){var n=x.find((function(t){return t.url===e}));if(n){n.loaded=t;var a=0;x.forEach((function(e){return a+=e.loaded}));var o=a/x.length;r(o),100===o&&Ve()}},window.XMLHttpRequest.prototype.open=function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1];return this.method=t,this.requestURL=n,Pe.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){return this.addEventListener("error",(function(t){e&&e(t.target.requestURL,100,!0)})),this.onprogress=function(t){if(e){var n=t.loaded/t.total*100;e(t.target.requestURL,n)}},We.apply(this,arguments)},function(){Ve(),Je=!0}}),[]),Object(o.useImperativeHandle)(t,(function(){return{getIsPaused:function(){return y},addPausedSound:function(e){m([].concat(Object(f.a)(d),[e]))},getCurrentLoop:function(){return S.current},playSound:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var a=e.sound,r=e.params;if("stop"===a){if(S.current&&S.current.sound&&j.current[S.current.sound]){var o=j.current[S.current.sound].sound;o.fade(1,0,500),S.current={sound:null,params:null}}}else if(j.current[a]&&j.current[a].sound){var c=j.current[a].sound,l=!1,i=e.params&&e.params.volume&&e.params.volume>0&&e.params.volume<1?e.params.volume:1,s=e.params&&e.params.speed?e.params.speed:1;if(n){if(S.current&&S.current.sound){var u=j.current[S.current.sound].sound;S.current.sound!==a?(u.volume()>0&&u.fade(u.volume(),0,500),c.fade(0,i,500)):0!==c.volume()&&c.playing()?(c.volume()!==i&&c.fade(c.volume(),i,500),l=!0):c.volume(i)}else c.fade(0,i,500);S.current={sound:a,params:r}}else c.volume(i);c.rate()!==s&&c.rate(s),l||(e.params&&e.params.delay&&e.params.delay>0?setTimeout((function(){!Je&&t.current&&(t.current.getIsPaused()?t.current.addPausedSound({id:e.sound,time:0}):c.play())}),1e3*e.params.delay):c.play())}}},fadeLoop:function(){if(S.current&&S.current.sound){var e=j.current[S.current.sound].sound;e.playing()&&e.fade(1,0,500)}},stopAllSounds:function(){m([]),l.forEach((function(e){var t=e.id,n=j.current[t];n&&n.sound&&n.sound.stop()}))},stopAllSfx:function(){m([]),l.forEach((function(e){var t=e.id,n=j.current[t];n&&n.sound&&!n.sound.loop()&&n.sound.stop()}))},resetPause:function(){m([]),v(!1)},togglePause:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(y)e||d.forEach((function(e){var t=e.id,n=e.time,a=j.current[t];a&&a.sound&&(a.sound.seek(n),a.sound.play())})),m([]);else{var t=[];l.forEach((function(e){var n=e.id,a=j.current[n];a&&a.sound&&a.sound.playing()&&(t.push({id:n,time:a.sound.seek()}),a.sound.stop())})),m(t)}v(!y)}}})),c.a.createElement(o.Fragment,null,l.map((function(e){return c.a.createElement(Ye,Object.assign({key:"snd-"+e.id,ref:function(t){return j.current[e.id]=t},onLoad:k},e))})))})),Ze=function(e){var t=Object(E.d)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(360deg)"},config:{duration:1e4},loop:!0});return c.a.createElement(E.a.div,{className:"object-modal-star",style:t},c.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"699.936",height:"699.936",viewBox:"0 0 699.936 699.936"},c.a.createElement("path",{opacity:".7",fill:e.color,d:"M349.968 199.968L404.72 4.277l-8.4 203.032L508.864 38.115l-70.728 190.5L597.455 102.48 471.32 261.8l190.5-70.729-169.194 112.544 203.033-8.399-195.691 54.752 195.691 54.752-203.033-8.4 169.193 112.544-190.499-70.728 126.135 159.319L438.136 471.32l70.728 190.5L396.32 492.626l8.4 203.033-54.752-195.691-54.752 195.691 8.399-203.033L191.071 661.82l70.729-190.5-159.32 126.135 126.135-159.319-190.5 70.728L207.309 396.32l-203.032 8.4 195.691-54.752L4.277 295.216l203.032 8.399L38.116 191.071 228.615 261.8 102.48 102.48 261.8 228.615l-70.729-190.5 112.544 169.194-8.399-203.032z"})))},Xe=(n(648),function(e){var t=e.params,n=e.theme,a=e.onClosed,r=e.textStyle,l=Object(o.useState)(!0),i=Object(s.a)(l,2),u=i[0],m=i[1],f=S.getAnimationStyle(n.styles.animations?n.styles.animations.objectModal:null),b=n.styles.animations?n.styles.animations.objectModalDecorator:null,g=Object(E.e)(),y=Object(E.d)(Object(d.a)({},f,{to:Object(d.a)({},f.to,{close:!1}),ref:g,onRest:function(e,n,r){e.value.close?a():setTimeout((function(){m(!1)}),1e3*(t.asset.duration||2))}}));Object(o.useLayoutEffect)((function(){u?g.start():g.start(Object(d.a)({},f.from,{close:!0}))}),[g,u]);return t&&c.a.createElement("div",{className:"object-modal-container",style:Object(d.a)({fontFamily:n.styles.fontFamily},r),onClick:function(){m(!1)}},c.a.createElement(E.a.div,{style:y,className:"object-modal-wrapper"},c.a.createElement("div",{className:"object-modal",style:{background:n.styles.background,borderRadius:1.5*(void 0===n.styles.sequenceRadius?1:n.styles.sequenceRadius)+"em",outline:"".concat(n.styles.sequenceBorderSize||"0","px ").concat(n.styles.sequenceBorderColor||"#fff"," solid")}},c.a.createElement("div",{style:{background:n.styles.sequenceBackground}},function(){var e=t.asset?t.asset.icon:null;return e?c.a.createElement(qe,{className:"modal-icon",icon:e,style:{fill:n.styles.sequenceText,stroke:n.styles.sequenceText}}):null}(),t.asset&&t.asset.desc&&c.a.createElement("div",{className:"object-modal-label",style:{marginTop:".5em",color:n.styles.sequenceText},dangerouslySetInnerHTML:{__html:z(t.asset.desc,{ALLOWED_TAGS:["b","i","br"]})}}))),"star"===b&&c.a.createElement(Ze,{color:n.styles.animations.objectModalDecoratorColor||"#FCEE21"})))}),$e=n(704),Qe=n(703),et=n(697),tt=n(698),nt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:260,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&e.length>t){if(n){var a=e.slice(0,t);return(a=a.slice(0,a.lastIndexOf(" ")))+"..."}return e.substring(0,t)+"..."}return e},at=function(e){var t=e.strings,n=e.story,a=function(e){if(e&&e.author){var t=e.author,n=t.firstname,a=t.lastname,r=t.pseudo,o=t.socialClubProfile;if(o&&o.slug&&!r)return"@"+o.slug;if(r)return r;if(n&&a)return n+" "+a}return null}(n.meta)||t.UNKNOWN;return c.a.createElement("div",{style:{fontStyle:"italic",color:"#9e9a9a",marginBottom:"1em"}},n.meta.originalAuthor?c.a.createElement(o.Fragment,null,c.a.createElement("span",null,t.STORY_BY," ",n.meta.originalAuthor),c.a.createElement("br",null),c.a.createElement("span",null,"(",t.ADAPTED_BY," ",a,")")):t.STORY_BY+" "+a)},rt=function(e){var t=e.story,n=e.showIfid,a=void 0===n||n;return c.a.createElement(D.Consumer,null,(function(e){return c.a.createElement(o.Fragment,null,c.a.createElement("div",{style:{fontStyle:"italic"}},e.PRESENT),c.a.createElement("h2",{style:{marginTop:"0.3em",marginBottom:"0.3em"}},T(t.meta.name)),c.a.createElement(at,{strings:e,story:t}),t.meta.ifid&&a&&c.a.createElement("div",{style:{fontStyle:"italic",fontSize:".8em",userSelect:"text",margin:"-10px -25px 5px",textAlign:"center",color:"#8a8a8a"}},"IFID : ",t.meta.ifid))}))},ot=n(355),ct=(new Date).getFullYear(),lt=function(){return c.a.createElement("div",{style:{width:"100%",textAlign:"center",position:"absolute",fontStyle:"italic",fontSize:".8em",color:"#999",bottom:10,left:0}},"Moiki \xa9 ",ct," - v.",ot.a)},it=function(e){var t=e.story,n=e.soundsLoaded,a=e.soundsProgress,r=e.onStart,l=e.onShowCredits,i=t.sounds&&Object.keys(t.sounds).length>0,u=!0;navigator&&navigator.userAgent&&(-1!==navigator.userAgent.indexOf("Nintendo")||-1!==navigator.userAgent.indexOf("Tesla"))&&(u=!1);var d=!u||n||!i||100===(a||0).toFixed(0);return Object(o.useEffect)((function(){if(t){var e,n=Object.entries(t.images).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),a=Object(b.a)(n);try{for(a.s();!(e=a.n()).done;){var r=e.value;(new Image).src=r.urlLocal||r.url}}catch(o){a.e(o)}finally{a.f()}}}),[t]),c.a.createElement(D.Consumer,null,(function(e){return c.a.createElement($e.a,{id:"story-start-screen",inverted:!0,padded:"very",style:{width:350,padding:"2.5em 3em"}},t?c.a.createElement(o.Fragment,null,c.a.createElement(rt,{story:t,showIfid:!1}),(t.meta.imageLocal||t.meta.image)&&c.a.createElement("div",null,c.a.createElement("img",{style:{maxHeight:225,overflow:"hidden",width:"100%"},src:t.meta.imageLocal||t.meta.image,alt:"",className:"cover"})),c.a.createElement("p",{style:{marginTop:"0.3em"}},nt(T(t.meta.description),260,!0)),c.a.createElement("div",{style:{height:"3em",display:"flex",justifyContent:"center",alignItems:"center"}},d?c.a.createElement(Qe.a,{id:"play-button",onClick:function(){return r({sounds:!0})},primary:!0,icon:"play",circular:!0,size:"huge",style:{margin:".75em"}}):c.a.createElement($e.a,{inverted:!0,style:{margin:"1em",color:"#9e9a9a"}},c.a.createElement("div",null,e.LOADING_SOUNDS,c.a.createElement("br",null),a.toFixed(0),"%"),c.a.createElement("div",{style:{width:"100%",height:4,position:"relative",background:"#666",display:"block",borderRadius:"2px",overflow:"hidden"}},c.a.createElement("div",{style:{height:"100%",width:a+"%",background:"#2185D0",display:"block"}})))),c.a.createElement(et.a,{inverted:!0}),c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(Qe.a,{id:"credits-button",className:"link-button",basic:!0,inverted:!0,size:"mini",onClick:l},e.SHOW_CREDITS))):c.a.createElement(tt.a,{active:!0}),c.a.createElement(lt,null))}))},st=(n(649),function(e){var t=e.story,n=e.stats,a=e.onReset,r=e.onClose,l=e.onShowCredits,i=e.onRestart,s=n.numSequencesShown,u=n.numSequencesTotal,d=n.numHeroesShown,m=n.numHeroesTotal,f=n.numObjectsShown,b=n.numObjectsTotal,g=n.numUndo,y=n.numReplays,v=n.numVictories,p=n.numDefeats,E=Math.round(s/u*100),h=-1;m>0&&(h=Math.round(d/m*100));var O=-1;b>0&&(O=Math.round(f/b*100));var S=0;return S=h>=0&&O>=0?(E+(h+O)/2)/2:h<0&&O<0?E:(E+h+O+1)/2,c.a.createElement(D.Consumer,null,(function(e){return c.a.createElement($e.a,{inverted:!0,padded:"very",style:{width:350}},c.a.createElement(Qe.a,{primary:!0,circular:!0,icon:"close",onClick:r,style:{position:"absolute",top:10,right:10}}),c.a.createElement(et.a,{inverted:!0,horizontal:!0,style:{marginTop:0}},e.PROGRESSION),c.a.createElement("div",{style:{width:70,height:70,margin:"1em auto"}},c.a.createElement(pe.a,{value:S,text:"".concat(Math.round(S),"%"),strokeWidth:10,styles:{text:{fontSize:"2em",fontWeight:"bold"}}})),c.a.createElement("div",null,e.SEQ_FOUND," ",c.a.createElement("b",null,"".concat(s," / ").concat(u))),m>0&&c.a.createElement("div",null,e.HEROES_FOUND," ",c.a.createElement("b",null,"".concat(d," / ").concat(m))),b>0&&c.a.createElement("div",null,e.OBJ_FOUND," ",c.a.createElement("b",null,"".concat(f," / ").concat(b))),c.a.createElement(et.a,{inverted:!0,horizontal:!0},e.STATS),t.meta&&t.meta.options.allowBack&&c.a.createElement("div",null,e.NUM_UNDO," ",c.a.createElement("b",null,g)),c.a.createElement("div",null,e.NUM_GAMES," ",c.a.createElement("b",null,y)),c.a.createElement("div",null,e.NUM_VICTORIES," ",c.a.createElement("b",null,v)),c.a.createElement("div",null,e.NUM_DEFEATS," ",c.a.createElement("b",null,p)),c.a.createElement(et.a,null),c.a.createElement(o.Fragment,null,c.a.createElement(Qe.a,{size:"large",inverted:!0,circular:!0,icon:"repeat",content:e.RESTART,onClick:i,style:{marginBottom:"1em"}}),c.a.createElement("br",null)),c.a.createElement(Qe.a,{size:"small",inverted:!0,circular:!0,content:e.RESET,onClick:a}),c.a.createElement(et.a,{inverted:!0}),c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},c.a.createElement(Qe.a,{className:"link-button",basic:!0,inverted:!0,size:"mini",onClick:l},e.SHOW_CREDITS)),c.a.createElement(lt,null))}))}),ut=function(e){var t=e.story,n=e.onClose,a=function(e){return-1!==e.indexOf("/by-nc/")?"BY-NC":-1!==e.indexOf("/zero/")?"CC":-1!==e.indexOf("/by/")||"creative-commons-attribution"===e?"BY":"public-domain"===e?"public":"???"},r=window.story_hooks?window.story_hooks.sounds:{},l=Object.entries(t.images).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),i=Object.entries(t.assets).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),u=i.filter((function(e){var t=e.info;return t&&t.license})).map((function(e){var t=e.icon,n=e.info;return{icon:t,attribution:n.attribution,license:a(n.license)}})),d=Object.entries(t.sounds).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})),m=d.filter((function(e){var t=e.sound;return t.username&&t.name&&t.license})).map((function(e){var t=e.sound;return{name:t.name,username:t.username,license:a(t.license),file:t.localFile.slice(t.localFile.indexOf("/")+1)}})),f=t.meta.imageInfo&&(t.meta.imageInfo.user||t.meta.imageInfo.ikFileId);return c.a.createElement(D.Consumer,null,(function(e){return c.a.createElement($e.a,{inverted:!0,padded:"very",style:{width:350,padding:"3em 1em"}},c.a.createElement(Qe.a,{basic:!0,inverted:!0,circular:!0,icon:"arrow left",onClick:n,style:{position:"absolute",top:10,left:10}}),t?c.a.createElement(o.Fragment,null,c.a.createElement(rt,{story:t}),c.a.createElement(et.a,{style:{marginTop:"2.5em"},inverted:!0,horizontal:!0},e.CREDITS),c.a.createElement("div",{style:{minHeight:130,maxHeight:192,overflowY:"auto"}},t.meta.customCredits&&(t.meta.customCredits.content||t.meta.customCredits.link)&&c.a.createElement("div",null,t.meta.customCredits.content&&c.a.createElement("div",null,nt(t.meta.customCredits.content,260,!0)),c.a.createElement("div",{style:{margin:".5em"}},t.meta.customCredits.link&&c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:t.meta.customCredits.link},t.meta.customCredits.imgLink?c.a.createElement("img",{style:{maxWidth:120,overflow:"hidden",width:"auto",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover"},src:t.meta.customCredits.imgLink,alt:"",className:"cover"}):e.READ_MORE)),c.a.createElement("div",{style:{display:"block",height:1,background:"rgba(255, 255, 255, 0.15)"}})),f&&c.a.createElement(o.Fragment,null,c.a.createElement("h4",null,e.COVER),c.a.createElement(h.a,{style:{margin:".4em auto"},src:t.meta.imageLocal||t.meta.image,size:"small",rounded:!0}),t.meta.imageInfo&&t.meta.imageInfo.user?c.a.createElement("div",null,"by ",c.a.createElement("a",{href:t.meta.imageInfo.hotlink,target:"_blank",rel:"noreferrer noopener"},t.meta.imageInfo.user),c.a.createElement("div",{style:{fontStyle:"italic",color:"#9e9a9a"}},"(",c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://unsplash.com/?utm_source=Moiki&utm_medium=moiki.fr"},"Unsplash"),")")):c.a.createElement("div",{style:{fontStyle:"italic",color:"#9e9a9a"}},t.meta.imageInfo&&t.meta.imageInfo.ikFileId?c.a.createElement("div",null,t.meta.imageInfo.customCredit||e.ALL_RIGHTS_RESERVED):c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://unsplash.com/?utm_source=Moiki&utm_medium=moiki.fr"},"Unsplash"))),l&&l.length>0&&c.a.createElement("div",{className:"credits-assets-list"},f&&c.a.createElement(et.a,null),c.a.createElement("h4",{style:{marginTop:"1em"}},e.IMAGES),c.a.createElement("div",{style:{fontStyle:"italic",color:"#9e9a9a"}},l&&l.map((function(t,n){return c.a.createElement("div",{key:"img-"+n,style:{marginBottom:"1em"}},c.a.createElement(h.a,{style:{margin:".4em auto"},src:t.urlLocal||t.url,size:"tiny",rounded:!0}),c.a.createElement("div",null,t.imageInfo.customCredit||e.ALL_RIGHTS_RESERVED))})))),i&&i.length>0&&c.a.createElement("div",{className:"credits-assets-list"},f&&c.a.createElement(et.a,null),c.a.createElement("h4",{style:{marginTop:"1em"}},e.ICONS),c.a.createElement("div",{style:{fontStyle:"italic",marginBottom:"1em",color:"#9e9a9a"}},e.ICONS_FROM,c.a.createElement("br",null),c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://thenounproject.com/"},"The Noun Project")),u&&u.map((function(t,n){var a=t.icon,r=t.attribution,l=t.license;return c.a.createElement(o.Fragment,{key:"icon-credit-"+n},n>0&&c.a.createElement("div",null,"---"),c.a.createElement(qe,{icon:a,style:{fill:"#fff",stroke:"#fff",margin:0,paddingBottom:".5em",paddingTop:"1em",display:"inline-block"}}),r&&c.a.createElement("div",{style:{overflowWrap:"break-word"}},r),c.a.createElement("div",{style:{fontSize:".7em"}},e.LICENSE," ",l))}))),d&&d.length>0&&c.a.createElement(o.Fragment,null,c.a.createElement(et.a,null),c.a.createElement("h4",{style:{marginTop:"1em"}},e.SOUNDS),m&&m.map((function(t,n){var a=t.name,l=t.username,i=t.license,s=t.file;return c.a.createElement(o.Fragment,{key:"sound-credit-"+n},n>0&&c.a.createElement("div",null,"---"),s&&r[s]?c.a.createElement(o.Fragment,null,c.a.createElement("div",null,c.a.createElement("em",{style:{overflowWrap:"break-word"}},r[s].credit||a)),r[s].license&&c.a.createElement("div",{style:{color:"#9e9a9a",margin:2}},e.LICENSE," ",r[s].license),r[s].link&&r[s].linkName&&c.a.createElement("div",null,"via ",c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:r[s].link},r[s].linkName))):c.a.createElement(o.Fragment,null,c.a.createElement("div",null,c.a.createElement("em",{style:{overflowWrap:"break-word"}},a)," by ",l),c.a.createElement("div",{style:{color:"#9e9a9a",margin:2}},e.LICENSE," ",i),c.a.createElement("div",null,"via ",c.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://freesound.org/"},"Freesound"))))}))))):c.a.createElement(tt.a,{active:!0}),c.a.createElement(lt,null))}))},dt=n(356),mt=n.n(dt),ft=(n(650),function(e){var t=e.story,n=e.onClose,a=e.showPlatformInfo,r=t.meta,l=r.description,i=r.image,s=r.imageLocal;return c.a.createElement(D.Consumer,null,(function(e){return c.a.createElement($e.a,{className:"story-about-screen",inverted:!0,padded:"very",style:{width:350,padding:"2.5em 3em"}},c.a.createElement(Qe.a,{primary:!0,circular:!0,icon:"close",onClick:n,style:{position:"absolute",top:10,right:10}}),c.a.createElement(o.Fragment,null,c.a.createElement(rt,{story:t}),(s||i)&&c.a.createElement("div",null,c.a.createElement("img",{style:{maxHeight:225,overflow:"hidden",width:"100%"},src:s||i,alt:"",className:"cover"})),c.a.createElement("p",{style:{marginTop:"0.3em"}},nt(l,260,!0)),a&&c.a.createElement("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",color:"#878787"}},c.a.createElement("img",{alt:"moiki logo",src:mt.a,style:{width:50,height:50}}),c.a.createElement("p",{style:{marginLeft:"1em",fontSize:".8em"}},c.a.createElement("em",null,c.a.createElement("a",{href:"https://moiki.fr",target:"_blank",rel:"noreferrer noopener"},"Moiki.fr")," ",e.ITS_FREE)))),c.a.createElement(lt,null))}))}),bt=n(699),gt=function(e){var t=e.title,n=e.content,a=e.open,r=e.cancelLabel,l=e.onCancel,i=e.confirmLabel,s=e.onConfirm,u=e.confirmIcon,d=void 0===u?null:u,m=e.cancelIcon,f=void 0===m?null:m,b=e.alternate,g=void 0!==b&&b;return c.a.createElement(bt.a,{open:a,dimmer:"blurring",style:{width:300,textAlign:"center"}},c.a.createElement($e.a,{inverted:!0},c.a.createElement("h3",null,t),n&&c.a.createElement(o.Fragment,null,c.a.createElement(et.a,null),n),c.a.createElement(et.a,null),g?c.a.createElement("div",{style:{textAlign:"center"}},s&&c.a.createElement(Qe.a,{size:"big",id:"modal-validate-button",color:"blue",onClick:s},d,i),l&&c.a.createElement("div",{style:{margin:"1em auto"}},c.a.createElement("button",{className:"button-link",id:"modal-cancel-button",onClick:l},f,r))):c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexWrap:"wrap"}},l&&c.a.createElement(Qe.a,{inverted:!0,id:"modal-cancel-button",onClick:l,style:{marginBottom:5}},f,r),s&&c.a.createElement(Qe.a,{size:"big",id:"modal-validate-button",color:"blue",onClick:s},d,i))))},yt=n(701),vt=function(e){var t=e.onClose,n=e.objects,a=e.getAssetById,r=e.styles,l=e.showTitleBar,i=e.defaultTheme,u=e.story,m=e.isCustomInventory,f=Object(o.useState)(null),b=Object(s.a)(f,2),y=b[0],p=b[1],E=Object(o.useRef)(r.sequenceStyles.inventoryBackground?r.sequenceStyles.inventoryBackground:r.sequenceStyles.assetsBackground);return Object(o.useEffect)((function(){E.current=r.sequenceStyles.inventoryBackground?r.sequenceStyles.inventoryBackground:r.sequenceStyles.assetsBackground}),[r]),c.a.createElement(D.Consumer,null,(function(e){return c.a.createElement(o.Fragment,null,m?c.a.createElement("div",{className:"story-player-container",style:{width:"100%",background:"none"}},c.a.createElement(v.a,null,l&&c.a.createElement("div",{className:"topbar",style:{background:r.sequenceStyles.topbarBackground,color:r.sequenceStyles.topbarText,fontFamily:i.styles.fontFamily}},"MOIKI ",u.meta?"- "+u.meta.name:""),c.a.createElement("div",{style:{display:"flex",width:"100%",height:l?"calc(100% - 19px)":"100%",position:"relative"}},c.a.createElement("div",{className:"game-bar",style:{background:r.sequenceStyles.assetsBackground}},c.a.createElement("div",{style:{width:100}}),n&&c.a.createElement("div",{style:Object(d.a)({marginTop:0,fontFamily:r.sequenceStyles.fontFamily,color:r.sequenceStyles.sequenceText},r.textStyle)},e.OBJ_WON," (",n.length,")"),c.a.createElement("div",{className:""},c.a.createElement("button",{style:Object(d.a)({},r.button,{outline:"none",textShadow:"none"}),onClick:t},c.a.createElement(g.a,{name:"close",style:{margin:0}})))),c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",width:"100%"}},c.a.createElement("div",{className:"win-objects-panel-container"},c.a.createElement("div",{className:"win-objects-panel-custom"},y?c.a.createElement("div",{className:"details-object-container",style:{outlineColor:E.current,background:E.current}},c.a.createElement("div",{style:{padding:"1.5em 1.5em 0"}},c.a.createElement("div",{style:Object(d.a)({fontWeight:"bold",fontSize:"1.8em",lineHeight:".9em",fontFamily:r.sequenceStyles.fontFamily,color:r.sequenceStyles.sequenceText},r.textStyle)},T(y.label).trim()),c.a.createElement(qe,{icon:y.icon,style:{fill:r.sequenceStyles.sequenceText,stroke:r.sequenceStyles.sequenceText,fontSize:"3em",padding:".3em 0 .5em",display:"inline-block"}}),c.a.createElement("div",{style:Object(d.a)({fontFamily:r.sequenceStyles.fontFamily,color:r.sequenceStyles.sequenceText,fontSize:"1.2em",lineHeight:"1em",marginBottom:"1em"},r.textStyle)},T(F(y.desc)).trim()),c.a.createElement("button",{style:Object(d.a)({},r.button),onClick:function(){return p(null)}},c.a.createElement(g.a,{name:"check",style:{margin:0}})))):c.a.createElement(yt.a.Group,{className:"list-objects-container",style:{justifyContent:"center",margin:0,flexWrap:"wrap",outlineColor:E.current,background:E.current}},n&&n.map((function(e,t){var n=a(e);return c.a.createElement(yt.a,{key:"win-object-".concat(t),style:{background:"none",margin:10,width:120,boxShadow:"none",fontSize:"1.4em"},onClick:function(){return p(n)}},c.a.createElement("div",{style:{background:r.sequenceStyles.sequenceBackground}},c.a.createElement(yt.a.Content,{className:"win-object-card",extra:!0,style:{position:"relative",padding:10}},c.a.createElement("div",{className:"win-object-name",style:Object(d.a)({fontFamily:r.sequenceStyles.fontFamily,color:r.sequenceStyles.sequenceText},r.textStyle)},T(n.label).trim()),c.a.createElement(qe,{icon:n.icon,style:{fill:r.sequenceStyles.sequenceText,stroke:r.sequenceStyles.sequenceText,margin:0,display:"flex",flexGrow:1,alignItems:"center"}}))))}))))))))):c.a.createElement($e.a,{inverted:!0,padded:"very",style:{width:350}},c.a.createElement(Qe.a,{primary:!0,circular:!0,icon:"close",onClick:t,style:{position:"absolute",top:10,right:10}}),n&&c.a.createElement(et.a,{inverted:!0,horizontal:!0,style:{marginTop:0}},e.OBJ_WON," (",n.length,")"),c.a.createElement("div",{className:"win-objects-panel"},n&&n.length>0?c.a.createElement("div",{className:"list-objects-container"},n&&n.map((function(e,t){var n=a(e);return c.a.createElement(o.Fragment,{key:"obj-renderer-".concat(t)},t>0&&c.a.createElement(et.a,null),c.a.createElement("div",{style:{marginBottom:"1em"}},c.a.createElement("div",{style:{color:"#9e9a9a",fontWeight:"bold",fontSize:20}},T(n.label).trim()),c.a.createElement(qe,{icon:n.icon,style:{fill:"#fff",stroke:"#fff",margin:0,paddingBottom:".5em",display:"inline-block"}}),c.a.createElement("div",{style:{color:"#fff"}},T(F(n.desc)).trim())))}))):c.a.createElement("p",null,e.NO_OBJ_WON))))}))},pt=function(e,t,n){var a=t.target,r=t.condition;if("hero"===(n.assets[a]||{}).kind)switch(r){case"with":return e.hero===a;case"without":return e.hero!==a;default:console.log("unknown condition: ",r)}else{var o=e.objects||[];switch(r){case"with":return o.includes(a);case"without":return!o.includes(a);default:console.log("unknown condition: ",r)}}return null},Et=function(e,t,n){var a,r=n.target,o=n.condition,c=n.value,l=void 0===c?0:c,i=n.valueType,s=n.minValueType,u=n.minValue,d=n.maxValueType,m=n.maxValue,f=e.counters[r]||{},b=t.counters||[],g=b.find((function(e){return e.id===r}));switch(i){case"random":var y,v;switch(s){case"counter":var p=b.find((function(e){return e.id===u}));y=p?p.value:f.min;break;default:y=u||f.min}switch(d){case"counter":var E=b.find((function(e){return e.id===m}));v=E?E.value:f.max;break;default:v=m||f.max}a=Math.floor(Math.random()*(v-y+1))+y;break;case"counter":a=b.find((function(e){return e.id===l})).value||0;break;default:a=l}if(g)switch(o){case"=":return g.value===a;case"!=":return g.value!==a;case">":return g.value>a;case">=":return g.value>=a;case"<":return g.value<a;case"<=":return g.value<=a;default:console.log("unknown condition: ",o)}return null},ht=function(e,t){var n=t.target,a=t.condition,r=t.value,o=(e.textvars||[]).find((function(e){return e.id===n}));if(o)switch(a){case"=":return o.value===r;case"!=":return o.value!==r;default:console.log("unknown condition: ",a)}return null},Ot=function(e,t){var n=t.target,a=t.condition,r=e||[];switch(a){case"by":return r.includes(n);case"not-by":return!r.includes(n);default:console.log("unknown condition: ",a)}return null},St=function(e,t,n,a){var r=a.kind,o=a.query,c=o.params||[],l=Object(s.a)(c,1)[0],i=void 0===l?{}:l;switch(r){case"object":return pt(t,i,e);case"counter":return Et(e,t,i);case"textvar":return ht(t,i);case"passage":return Ot(n,i);case"multiple":return function(e,t,n,a){var r,o=a.operator,c=a.params,l="and"===o,i=l&&c.length>0,s=!1,u=Object(b.a)(c||[]);try{for(u.s();!(r=u.n()).done;){var d=r.value;switch(d.kind){case"object":s=pt(t,d,e);break;case"counter":s=Et(e,t,d);break;case"textvar":s=ht(t,d);break;case"passage":s=Ot(n,d);break;default:console.log("unknown multi-condition item kind",d.kind)}i=l?i&&s:i||s}}catch(m){u.e(m)}finally{u.f()}return i}(e,t,n,o);default:return r&&console.log("unknown condition kind: ",r),!1}},jt=function(e,t,n,a){var r=null;if(a&&a.length>0)for(var o=0;o<a.length&&!r;){var c=a[o];St(e,t,n,c)&&(r=c.next),++o}return r},kt=function(e,t,n){var a=n.kind,r=n.params;switch(a){case"object":return function(e,t,n){var a=n.target,r=n.modifier,o=e.assets[a]||{},c=null,l=!1,i=!1,s=null,u=null,m=null;if("hero"===o.kind)t.hero===a||"toggle"!==r&&"add"!==r?t.hero!==a||"toggle"!==r&&"sub"!==r||(i=!0,c=Object(d.a)({},t,{hero:null})):(s=a,m={asset:o},c=Object(d.a)({},t,{hero:a}),l=!0);else if((t.objects||[]).includes(a)||"toggle"!==r&&"add"!==r)!(t.objects||[]).includes(a)||"toggle"!==r&&"sub"!==r||(i=!0,c=Object(d.a)({},t,{objects:t.objects.filter((function(e){return e!==a}))}));else{u=a,m={asset:o};var b=[].concat(Object(f.a)(t.objects||[]),[a]);c=Object(d.a)({},t,{objects:b}),l=!0}var g=null;return(l||i)&&(g=l?"objectWin":"objectLose"),{gameData:c,sound:g,heroShown:s,objectShown:u,modal:m}}(e,t,r);case"counter":return function(e,t,n){var a,r=n.target,o=n.modifier,c=n.value,l=void 0===c?0:c,i=n.valueType,s=n.minValueType,u=n.minValue,m=n.maxValueType,b=n.maxValue,g=n.animation,y=null,v=e.counters[r]||{},p=Object(f.a)(t.counters||[]);if(!p.find((function(e){return e.id===r})))return console.log("cannot find counter with id: ",r),null;switch(i){case"random":var E,h;switch(s){case"counter":var O=p.find((function(e){return e.id===u}));E=O?O.value:v.min;break;default:E=u||v.min}switch(m){case"counter":var S=p.find((function(e){return e.id===b}));h=S?S.value:v.max;break;default:h=b||v.max}a=Math.floor(Math.random()*(h-E+1))+E,y=g?{randomValue:a}:null;break;case"counter":a=p.find((function(e){return e.id===l})).value||0;break;default:a=l||0}if(isNaN(a)||"number"!==typeof a)return null;var j=null,k=!1;switch(o){case"set":j=p.map((function(e){return e.id===r?{id:e.id,value:Math.max(Math.min(a,v.max),v.min)}:e}));break;case"add":j=p.map((function(e){return e.id===r?{id:e.id,value:Math.min(e.value+a,v.max)}:e}));break;case"sub":j=p.map((function(e){return e.id===r?{id:e.id,value:Math.max(e.value-a,v.min)}:e}));break;default:k=!0}if(!k){var x="counter"+o.slice(0,1).toUpperCase()+o.slice(1);return{gameData:Object(d.a)({},t,{counters:j}),modal:y,sound:x}}return null}(e,t,r);case"textvar":return function(e,t,n){var a,r=n.target,o=n.modifier,c=n.value,l=n.valueType,i=e.textvars[r]||{},s=Object(f.a)(t.textvars||[]),u=s.find((function(e){return e.id===r}));if(!u)return console.log("cannot find textvar with id: ",r),null;switch(l){case"random":var m=i.values?i.values.length:0,b=Math.floor(Math.random()*(m-0+1))+0;a=i.values&&i.values.length>b?i.values[b]:i.values[0];break;case"counter":var g=Object(f.a)(t.counters||[]).find((function(e){return e.id===c})).value||0;a=i.values&&i.values.length>g?i.values[g]:i.values[0];break;default:a=i.values&&i.values.find((function(e){return e.id===c}))}var y=a?a.id:u.name,v=null,p=!1;switch(o){case"set":v=s.map((function(e){return e.id===r?{id:e.id,value:y}:e}));break;default:p=!0}return p?null:{gameData:Object(d.a)({},t,{textvars:v})}}(e,t,r);case"redirect":return{redirectTo:r.target};default:console.log("unknown action ",a)}return null},xt=function(e){var t=e.counter,n=e.value,a=e.styles;return c.a.createElement("div",{style:a},c.a.createElement("div",null,t.name),c.a.createElement("div",null,isNaN(n)||null===n?t.defaultValue:n))},qt=function(e){var t=e.counter,n=e.value,a=e.styles;return c.a.createElement("div",{style:a},c.a.createElement("div",null,t.name),c.a.createElement("div",null,isNaN(n)||null===n?t.defaultValue:n," / ",t.max))},wt=function(e){var t=e.counter,n=e.value,a=e.styles;return c.a.createElement("div",{style:a},c.a.createElement("div",null,t.name),c.a.createElement("div",null,"".concat((n-t.min)/(t.max-t.min)*100,"%")))},Ct=function(e){var t=e.counter,n=e.value,a=e.styles;return c.a.createElement("div",{style:a},c.a.createElement("div",null,t.name),c.a.createElement("div",{style:{margin:".2em 0",width:100,display:"block",borderRadius:".5em",height:"1em",border:"2px ".concat(a.color," solid"),overflow:"hidden",boxShadow:a.textShadow}},c.a.createElement("div",{style:{width:"".concat((n-t.min)/(t.max-t.min)*100,"%"),display:"block",height:"1em",background:a.color}})))},Rt=function(e){var t=e.styles,n=e.computedStyles,a=Object(m.a)(e,["styles","computedStyles"]),r=a.gauge,o=Object(m.a)(a,["gauge"]);if(!n.sequence)return null;var l=Object(d.a)({},n.sequence,{},n.textStyle,{color:t.assetsFill,background:"none"});switch(r.kind){case"bar":return c.a.createElement(Ct,Object.assign({},o,{styles:l}));case"percent":return c.a.createElement(wt,Object.assign({},o,{styles:l}));case"total":return c.a.createElement(qt,Object.assign({},o,{styles:l}));default:return c.a.createElement(xt,Object.assign({},o,{styles:l}))}},Tt=n(358),Bt=n.n(Tt),zt=n(363),Nt=function(e){var t=e.url,n=e.options,a=e.bgStylesFix,r=void 0===a?{}:a,l=Object(o.useState)(t),i=Object(s.a)(l,2),u=i[0],m=i[1],f=Object(o.useState)(t),b=Object(s.a)(f,2),g=b[0],y=b[1],v=Object(o.useState)({}),p=Object(s.a)(v,2),E=p[0],h=p[1],O=Object(zt.a)({variants:{opacity:{from:0,to:1}},initial:t?"visible":"hidden",duration:300});return Object(o.useEffect)((function(){!!g!==!!t&&O.togglePresence(),y(t),t&&m(t)}),[t]),Object(o.useEffect)((function(){if(n){var e={align:{vertical:n.vAlign,horizontal:n.hAlign},styles:{opacity:n.opacity}};n.scale&&"height"===n.scale.base?e.styles=Object(d.a)({},e.styles,{width:"auto",height:n.scale.value+n.scale.kind}):n.scale&&"width"===n.scale.base&&(e.styles=Object(d.a)({},e.styles,{height:"auto",width:n.scale.value+n.scale.kind})),h(e)}else h({})}),[n]),c.a.createElement(o.Fragment,null,O.isRendered&&c.a.createElement("div",{className:"story-background-container",ref:O.ref,style:{position:"absolute",zIndex:0,width:"100%",height:"100%",display:"flex",justifyContent:E.align?E.align.horizontal:"center",alignItems:E.align?E.align.vertical:"center"}},c.a.createElement("img",{alt:"",src:u,style:Object(d.a)({},E.styles,{},r)})))},It=function(e){var t=e.theme,n=e.images,a=e.bgStylesFix,r=Object(o.useState)(null),l=Object(s.a)(r,2),i=l[0],u=l[1],d=Object(o.useState)(null),m=Object(s.a)(d,2),f=m[0],b=m[1],g=Object(o.useState)({}),y=Object(s.a)(g,2),v=y[0],p=y[1];return Object(o.useEffect)((function(){a&&(a&&"function"===typeof a?p(a(t)):a&&p(a))}),[t,a]),Object(o.useEffect)((function(){n&&t&&t.image&&n[t.image.id]?(u(n[t.image.id].url),b(t.image.options)):u(null)}),[t,n]),c.a.createElement(Nt,{url:i,options:f,bgStylesFix:v})},Mt=(n(651),function(e){var t=e.params,n=e.theme,a=e.onClosed,r=e.textStyle,l=Object(o.useState)(!1),i=Object(s.a)(l,2),u=i[0],m=i[1],f=q.getAnimationStyle(n.styles.animations?n.styles.animations.objectModal:null),b=n.styles.animations?n.styles.animations.objectModalDecorator:null,g=Object(E.e)(),y=Object(E.d)(Object(d.a)({},f,{to:Object(d.a)({},f.to,{close:!1}),ref:g,onRest:function(e,n,r){e.value.close?a():setTimeout((function(){m(!1)}),1e3*(t.asset.duration||2))}}));Object(o.useLayoutEffect)((function(){u?g.start():g.start(Object(d.a)({},f.from,{close:!0}))}),[g,u]);return t&&c.a.createElement("div",{className:"random-modal-container",style:Object(d.a)({fontFamily:n.styles.fontFamily},r),onClick:function(){m(!1)}},c.a.createElement(E.a.div,{style:y,className:"random-modal-wrapper"},c.a.createElement("div",{className:"random-modal",style:{background:n.styles.background,borderRadius:1.5*(void 0===n.styles.sequenceRadius?1:n.styles.sequenceRadius)+"em",outline:"".concat(n.styles.sequenceBorderSize||"0","px ").concat(n.styles.sequenceBorderColor||"#fff"," solid")}},c.a.createElement("div",{style:{background:n.styles.sequenceBackground}},t.randomValue&&c.a.createElement("div",{className:"random-modal-label",style:{color:n.styles.sequenceText}},t.randomValue))),"star"===b&&c.a.createElement(Ze,{color:n.styles.animations.objectModalDecoratorColor||"#FCEE21"})))}),Ft=function(e){var t=e.story,n=e.path,a=e.savePoints,r=e.computedStyles,l=e.onUndo,i=e.onShowOptions,u=e.onShowAbout,f=e.onExit,b=[e.displayExitButton?{icon:"power off",onClick:function(){return f()}}:null,{icon:"info",onClick:function(){u(),setTimeout((function(){h(!1)}),1)}},{icon:"setting",onClick:function(){i(),setTimeout((function(){h(!1)}),1)}},t.meta&&t.meta.options.allowBack?{icon:"undo",onClick:l,disabled:n.length<=1||0===a.length||1===a.length&&I(n,a[0].path)}:null].filter((function(e){return!!e})),y=Object(o.useState)(!1),v=Object(s.a)(y,2),p=v[0],h=v[1],O=Object(o.useMemo)((function(){return{from:{iconBottom:"0.3em",iconsMarginTop:"2.5em",size:"2.4em",borderTopRightRadius:"1.4em",borderTopLeftRadius:"0em"},to:{iconBottom:p?"-10em":"0.3em",iconsMarginTop:p?"0em":"2.5em",size:p?"".concat(1+2*b.length,"em"):"2.4em",borderTopRightRadius:p?"2em":"1.4em",borderTopLeftRadius:p?"2em":"0em"}}}),[p]),S=Object(E.e)(),j=Object(E.d)(Object(d.a)({ref:S,config:E.b.stiff},O)),k=j.size,x=j.iconBottom,q=j.iconsMarginTop,w=Object(m.a)(j,["size","iconBottom","iconsMarginTop"]);Object(o.useLayoutEffect)((function(){p?S.start(O.to):S.start(O.from)}),[p,O]);var C=function(e){if(p){var t=e.target,n=!0;do{t.classList.contains("player-menu")&&(n=!1),t=t.parentElement||t.parentNode}while(t.classList&&!t.classList.contains("story-player-container"));n&&h(!1)}};return Object(o.useEffect)((function(){return window.addEventListener("mousedown",C),function(){window.removeEventListener("mousedown",C)}})),c.a.createElement(o.Fragment,null,c.a.createElement(E.a.div,{style:Object(d.a)({},r.button,{borderRadius:0},w,{width:"2.4em",height:k,position:"absolute",zIndex:4,bottom:0,left:0,overflow:"hidden",textShadow:"none",outline:"none"}),className:"player-menu",onClick:function(){return h(!0)}},c.a.createElement(E.a.div,{style:{marginTop:q}},b?b.map((function(e,t){return c.a.createElement("button",{key:"item-"+t,style:Object(d.a)({},r.button,{opacity:e.disabled?.5:1,display:"block",marginLeft:".3em",marginBottom:".5em",background:"none",outline:"none",border:"none",textShadow:"none"}),onClick:e.onClick,disabled:e.disabled},c.a.createElement(g.a,{name:e.icon,style:{margin:0}}))})):null),c.a.createElement(E.a.div,{style:{display:"flex",alignItems:"center",justifyContent:"center",opacity:.7,width:"1.8em",height:"1.8em",left:"0.2em",bottom:x,zIndex:5,position:"absolute",pointerEvents:"none"}},c.a.createElement("div",null,c.a.createElement(g.a,{name:"bars",style:{margin:0,height:"auto"}})))))},Lt=(n(652),function(){return[0,1,2,3,4,5,6,7,8,9].map((function(e){return Math.random()}))}),_t=!1,Dt=Object(o.forwardRef)((function(e,t){var n=e.reducedViewport,a=void 0!==n&&n,r=e.bgStylesFix,l=void 0===r?null:r,i=e.onReady,u=e.onStart,y=e.onSequenceChanged,p=e.onSavePoint,E=e.onSaveReset,h=e.onHappyEnd,O=e.onTragicEnd,S=e.soundsEnabled,j=void 0===S||S,k=e.displayExitButton,x=void 0!==k&&k,q=e.onExit,w=e.showPlatformInfo,C=void 0===w||w,R=e.canShowStats,T=void 0===R||R,B=Object(o.useState)(null),z=Object(s.a)(B,2),N=z[0],F=z[1],A=Object(o.useState)(0),U=Object(s.a)(A,2),H=U[0],P=U[1],W=Object(o.useState)([]),V=Object(s.a)(W,2),G=V[0],Y=V[1],J=Object(o.useState)(0),K=Object(s.a)(J,2),Z=K[0],X=K[1],$=Object(o.useState)([]),Q=Object(s.a)($,2),ee=Q[0],te=Q[1],ne=Object(o.useState)(0),ae=Object(s.a)(ne,2),re=ae[0],oe=ae[1],ce=Object(o.useState)([]),le=Object(s.a)(ce,2),ie=le[0],se=le[1],ue=Object(o.useState)(null),be=Object(s.a)(ue,2),ge=be[0],ye=be[1],ve=Object(o.useState)(null),pe=Object(s.a)(ve,2),Ee=pe[0],he=pe[1],Oe=Object(o.useState)(null),Se=Object(s.a)(Oe,2),je=Se[0],ke=Se[1],xe=Object(o.useState)(null),we=Object(s.a)(xe,2),Ce=we[0],Re=we[1],Te=Object(o.useState)(null),Be=Object(s.a)(Te,2),ze=Be[0],Ne=Be[1],Ie=Object(o.useState)(null),Me=Object(s.a)(Ie,2),Fe=Me[0],Le=Me[1],_e=Object(o.useState)(null),De=Object(s.a)(_e,2),Ae=De[0],Ue=De[1],Pe=Object(o.useState)(null),We=Object(s.a)(Pe,2),Ve=We[0],Ge=We[1],Ye=Object(o.useState)(null),Je=Object(s.a)(Ye,2),Ze=Je[0],$e=Je[1],Qe=Object(o.useState)(null),et=Object(s.a)(Qe,2),tt=et[0],nt=et[1],at=Object(o.useState)(!e.isPreview),rt=Object(s.a)(at,2),ot=rt[0],ct=rt[1],lt=Object(o.useState)({}),dt=Object(s.a)(lt,2),mt=dt[0],bt=dt[1],yt=Object(o.useState)(!1),pt=Object(s.a)(yt,2),Et=pt[0],ht=pt[1],Ot=Object(o.useState)(0),xt=Object(s.a)(Ot,2),qt=xt[0],wt=xt[1],Ct=Object(o.useState)(0),Tt=Object(s.a)(Ct,2),zt=Tt[0],Nt=Tt[1],Dt=Object(o.useState)(null),At=Object(s.a)(Dt,2),Ut=At[0],Ht=At[1],Pt=Object(o.useState)([]),Wt=Object(s.a)(Pt,2),Vt=Wt[0],Gt=Wt[1],Yt=Object(o.useState)([]),Jt=Object(s.a)(Yt,2),Kt=Jt[0],Zt=Jt[1],Xt=Object(o.useState)([]),$t=Object(s.a)(Xt,2),Qt=$t[0],en=$t[1],tn=Object(o.useState)([]),nn=Object(s.a)(tn,2),an=nn[0],rn=nn[1],on=Object(o.useState)(!1),cn=Object(s.a)(on,2),ln=cn[0],sn=cn[1],un=Object(o.useState)(0),dn=Object(s.a)(un,2),mn=dn[0],fn=dn[1],bn=Object(o.useState)(0),gn=Object(s.a)(bn,2),yn=gn[0],vn=gn[1],pn=Object(o.useState)(0),En=Object(s.a)(pn,2),hn=En[0],On=En[1],Sn=Object(o.useState)(0),jn=Object(s.a)(Sn,2),kn=jn[0],xn=jn[1],qn=Object(o.useState)([]),wn=Object(s.a)(qn,2),Cn=wn[0],Rn=wn[1],Tn=Object(o.useState)(!1),Bn=Object(s.a)(Tn,2),zn=Bn[0],Nn=Bn[1],In=Object(o.useState)(!1),Mn=Object(s.a)(In,2),Fn=Mn[0],Ln=Mn[1],_n=Object(o.useState)(!1),Dn=Object(s.a)(_n,2),An=Dn[0],Un=Dn[1],Hn=Object(o.useState)(null),Pn=Object(s.a)(Hn,2),Wn=Pn[0],Vn=Pn[1],Gn=Object(o.useState)(null),Yn=Object(s.a)(Gn,2),Jn=Yn[0],Kn=Yn[1],Zn=Object(o.useState)(null),Xn=Object(s.a)(Zn,2),$n=Xn[0],Qn=Xn[1],ea=Object(o.useState)({}),ta=Object(s.a)(ea,2),na=ta[0],aa=ta[1],ra=Object(o.useState)({}),oa=Object(s.a)(ra,2),ca=oa[0],la=oa[1],ia=Object(o.useState)({}),sa=Object(s.a)(ia,2),ua=sa[0],da=sa[1],ma=Object(o.useState)({}),fa=Object(s.a)(ma,2),ba=fa[0],ga=fa[1],ya=Object(o.useState)(null),va=Object(s.a)(ya,2),pa=va[0],Ea=va[1],ha=Object(o.useState)(null),Oa=Object(s.a)(ha,2),Sa=Oa[0],ja=Oa[1],ka=Object(o.useState)(null),xa=Object(s.a)(ka,2),qa=xa[0],wa=xa[1],Ca=Object(o.useState)(0),Ra=Object(s.a)(Ca,2),Ta=Ra[0],Ba=Ra[1];Object(o.useEffect)((function(){if(j||pa){if(j&&!pa&&Ta>0){var t=Date.now()-Ta;Ba(0),t>12e3&&e.onExit(!0)}}else Ba(Date.now())}),[j]);var za=Object(o.useRef)(),Na=Object(o.useRef)(null);Object(o.useImperativeHandle)(t,(function(){return{updateSequence:Ya,loadGame:Ma}}));var Ia=function(){var t=[];e.story&&e.story.counters&&(t=Object.entries(e.story.counters).map((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);return{id:n.id,value:n.defaultValue||0}})));var n=[];return e.story&&e.story.textvars&&(n=Object.entries(e.story.textvars).map((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);return{id:n.id,value:n.values&&n.values.length>0?n.values[0].id:n.name}}))),e.defaultGameData?Object(d.a)({counters:t,textvars:n},e.defaultGameData):{counters:t,textvars:n}};Object(o.useEffect)((function(){if(!e.story)throw new Error("No story was given!");var t,n,a=Object(b.a)(e.story.themes);try{var r=function(){var a=n.value;if(a.identifier===(e.story.sequences[e.story.firstSequence].themeId||"default")&&(t=a),"default"===a.identifier){var r=de.find((function(e){return e.name===a.name}))||me;Kn(Object(d.a)({},r,{},a))}};for(a.s();!(n=a.n()).done;)r()}catch(u){a.e(u)}finally{a.f()}if(Qn(t),te([]),se([]),e.story.counters){var o=Object.entries(e.story.counters).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]}));Vn(o.filter((function(e){return!!e.gauge})))}Y([e.story.firstSequence]),ye(e.story.firstSequence),Zt([]),en([]),rn([]),P(Object.entries(e.story.sequences).filter((function(e){var t=Object(s.a)(e,2);t[0];return!t[1].routineId})).filter((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);return!(n.final&&n.hasOwnProperty("routineExitLabel"))})).length);var c=Object.entries(e.story.assets).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]}));X(c.filter((function(e){return"hero"===e.kind})).map((function(e){return e.id})).length),oe(c.filter((function(e){return"object"===e.kind})).map((function(e){return e.id})).length);var l=Ia(),i=e.story.sequences?e.story.sequences[e.story.firstSequence]:null;i&&i.choices&&i.choices.length>0?Rn([{id:e.story.firstSequence,path:[e.story.firstSequence],routinesExit:[],eventsDone:[],eventsPaused:[],currentLoop:i.soundLoop&&i.soundLoop.sound?i.soundLoop:null,currentTheme:t||"default",gameData:l,randomSeeds:Lt()}]):Rn([]),F(e.story),he(l)}),[e.story]),Object(o.useEffect)((function(){N&&0===mn&&Ya()}),[N,mn]);Object(o.useEffect)((function(){if(y&&y(ge),e.story.sequences&&ge&&e.story.sequences[ge]){var t=e.story.sequences[ge];if(t.final&&!t.hasOwnProperty("routineExitLabel")){var n={numReplays:mn,numVictories:yn,numDefeats:hn,numUndo:kn,numSequencesShown:G.length,percentViewedSequences:(G.length/H).toFixed(2)};t.isHappyEnd&&h?h(n):!t.isHappyEnd&&O&&O(n)}if(!_t&&p&&Vt&&Vt.length>1){var a=null;a=t.soundLoop&&t.soundLoop.sound?t.soundLoop:Na.current?Na.current.getCurrentLoop():null,p({data:[].concat(Object(f.a)(Cn),[{id:ge,path:Vt,currentLoop:a,currentTheme:$n?$n.identifier:null,gameData:Ee,routinesExit:Kt,eventsDone:Qt,eventsPaused:an,randomSeeds:Lt()}]),stats:{sequencesShown:G,heroesShown:ee,objectsShown:ie,numReplays:mn,numVictories:yn,numDefeats:hn,numUndo:kn}})}}_t&&(_t=!1)}),[ge,Vt,y,qa]),Object(o.useEffect)((function(){_t=!1,Nt((new Date).getTime())}),[]),Object(o.useEffect)((function(){var e=(new Date).getTime();if(N){var t=Object.keys(N.sounds||{}).length;if(Et||0===t)Ht(e-zt),i&&i()}}),[Et,N]);var Ma=function(e){Ea(e)},Fa=function(e){var t=N&&N.sequences?N.sequences[e]:null;if(t&&t.choices){var n=t.choices.filter((function(e){return!(t=e).showCondition||!t.showCondition.kind||St(N,Ee,Vt,t.showCondition);var t}));t=Object(d.a)({},t,{choices:t.randomOrder?M(n):n.map((function(e,t){return Object(d.a)({},e,{originalIndex:t})}))})}return t},La=function(e){var t=Object(o.useRef)();return Object(o.useEffect)((function(){t.current=e})),t.current}({sequenceId:ge});Object(o.useEffect)((function(){if(!ot){var t=Fa(ge);if(t&&La&&La.sequenceId!==ge&&(t.final&&!t.hasOwnProperty("routineExitLabel")&&(er(),t.isHappyEnd&&na.sfx&&na.sfx.gameWin?Xa(na.sfx.gameWin):!t.isHappyEnd&&na.sfx&&na.sfx.gameLose&&Xa(na.sfx.gameLose)),t&&t.soundSfx&&Xa(t.soundSfx),t&&t.soundLoop&&(!t.final||t.hasOwnProperty("routineExitLabel"))&&Xa(t.soundLoop,!0)),t){var n=e.story.themes.find((function(e){return e.identifier===t.themeId}));n&&n.identifier!==($n||{}).identifier&&Qn(n)}}}),[ge,ot]);var _a=function(e){return N.assets[e]||{}};Object(o.useEffect)((function(){var e=Ae;e&&(Ve||0===Ve)&&(e.length>Ve?Wa(e[Ve],!0)&&Da():(Ue(null),Ge(null),Aa()))}),[Ae,Ve]);var Da=function(){Ge((function(e){return e+1}))},Aa=function(){nt((function(e){return e+1}))},Ua=function(e){e.condition&&St(N,Ee,Vt,e.condition)&&!an.includes(e.id)?("once"===e.kind&&en([].concat(Object(f.a)(Qt),[e.id])),"on-true"===e.kind&&rn([].concat(Object(f.a)(an),[e.id])),function(e){var t=e.actions||[];t&&t.length>0?(Ue(t),Ge(0)):Aa()}(e)):(e.condition&&!St(N,Ee,Vt,e.condition)&&"on-true"===e.kind&&an.includes(e.id)&&rn(Object(f.a)(an.filter((function(t){return t!==e.id})))),Aa())};Object(o.useEffect)((function(){var e=Ze||{},t=e.events,n=e.id,a=e.conditions,r=e.isRedirect,o=void 0!==r&&r;t&&(tt||0===tt)&&(t.length>tt&&!o?Ua(t[tt]):(Ue(null),Ge(null),$e(null),nt(null),Ya(n,a)))}),[Ze,tt]);var Ha=function(e,t){var n=N.events.filter((function(e){return!Qt.includes(e.id)}));$e({id:e,conditions:t,events:n}),nt(0)},Pa=function(){Le((function(e){return e+1}))},Wa=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=kt(N,Ee,e);if(n){if(n.heroShown&&!ee.includes(n.heroShown)&&te([].concat(Object(f.a)(ee),[n.heroShown])),n.objectShown&&!ie.includes(n.objectShown)&&se([].concat(Object(f.a)(ie),[n.objectShown])),n.sound&&na.sfx&&na.sfx[n.sound]&&Xa(na.sfx[n.sound]),n.gameData&&he(n.gameData),n.modal)return n.modal.asset?ke(Object(d.a)({},n.modal,{fromEventAction:t})):n.modal.randomValue&&Re(Object(d.a)({},n.modal,{fromEventAction:t})),!1;if(n.redirectTo)return Zt([]),$e({id:n.redirectTo,conditions:[],events:Ze.events,isRedirect:!0}),!1}return!0};Object(o.useEffect)((function(){var e=ze||{},t=e.actions,n=e.id,a=e.conditions;t&&(Fe||0===Fe)&&(t.length>Fe?Wa(t[Fe])&&Pa():(Ne(null),Le(null),N.events&&N.events.length>0?Ha(n,a):Ya(n,a)))}),[ze,Fe]);var Va=function(e,t,n){Ne({id:e,actions:t,conditions:n}),Le(0)},Ga=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e?t&&t.length>0?Va(e,t,n):N.events&&N.events.length>0?Ha(e,n):Ya(e,n,a):Ya()},Ya=function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return fn(mn+1),0===G.length&&Y([N.firstSequence]),N.sequences[N.firstSequence]&&N.sequences[N.firstSequence].choices&&N.sequences[N.firstSequence].choices.length>0?Rn([{id:N.firstSequence,path:[N.firstSequence],routinesExit:[],eventsDone:[],eventsPaused:[],currentLoop:N.sequences[N.firstSequence].soundLoop&&N.sequences[N.firstSequence].soundLoop.sound?N.sequences[N.firstSequence].soundLoop:null,currentTheme:N.sequences[N.firstSequence].themeId||"default",gameData:Ee,randomSeeds:Lt()}]):Rn([]),wa(N.firstSequence),Zt([]),en([]),rn([]),Gt([N.firstSequence]),he(Ia()),ye(N.firstSequence),$a(),void tr(mt);var r=t;if(n&&n.length>0){var o=jt(N,Ee,Vt,n);o&&(r=o)}if(N.sequences[t]&&N.sequences[t].puzzle&&"object"===N.sequences[t].puzzle.kind){var c,l=N.sequences[t].puzzle,i=Object.entries(N.assets||{}).map((function(e){var t=Object(s.a)(e,2);t[0];return t[1]})).filter((function(e){return"object"===e.kind})),u=Object(f.a)(new Set(i.map((function(e){return e.tags})).reduce((function(e,t){return e.concat(t)}),[]))),d=(l.onlyTags||[]).filter((function(e){return u.indexOf(e)>=0}));switch(l.inventoryStrategy){case"not-in":c=i.filter((function(e){return-1===(Ee.objects||[]).indexOf(e.id)}));break;case"added":c=l.codes.map((function(e){return i.find((function(t){return t.id===e.value}))}));break;default:c=(Ee.objects||[]).map((function(e){return N.assets[e]}))}if(l.noObjectNext)if(0===c.length)r=l.noObjectNext;else if(d&&d.length>0){var m=c.filter((function(e){return L(e,d,l.tagStrategy,u)}));0===m.length&&(r=l.noObjectNext)}}var b=a||Kt,g=N.sequences[r]&&N.sequences[r].redirectTo?N.sequences[r].redirectTo:r,y=[].concat(Object(f.a)(Vt),[r]),v=b;if(g!==r&&(y=[].concat(Object(f.a)(Vt),[r,g]),v=[].concat(Object(f.a)(b),[N.sequences[r].routineExit]),Zt(v)),N.sequences[g]&&N.sequences[g].final&&b&&b.length>0){var p=b[b.length-1].find((function(e){return e.from===g}));if(p)return v=b.slice(0,-1),Zt(v),void Ga(p.next,p.actions,p.conditions,v)}Gt(y),G.includes(g)||Y([].concat(Object(f.a)(G),[g])),N.sequences[g]&&N.sequences[g].final&&!N.sequences[g].hasOwnProperty("routineExitLabel")&&(N.sequences[g].isHappyEnd?vn(yn+1):On(hn+1));var E=N.sequences[g]&&N.sequences[g].themeId;if(E){var h=e.story.themes.find((function(e){return e.identifier===E}));h&&h.identifier!==($n||{}).identifier&&Qn(h)}if(wa(g),N.sequences[g]&&N.sequences[g].image&&N.sequences[g].image.id&&N.images){var O=N.images[N.sequences[g].image.id];if(O&&O.url){var S=new Image;return S.onload=function(){Ja(g,y,v,E)},void(S.src=O.url)}}Ja(g,y,v,E)},Ja=function(e,t,n,a){if(N.sequences[e]&&(N.sequences[e].choices&&N.sequences[e].choices.length>0||N.sequences[e].puzzle)){var r=null;r=N.sequences[e].soundLoop&&N.sequences[e].soundLoop.sound?N.sequences[e].soundLoop:Na.current?Na.current.getCurrentLoop():null;var o=[].concat(Object(f.a)(Cn),[{id:e,path:t,routinesExit:n,eventsDone:Qt,eventsPaused:an,currentLoop:r,currentTheme:a||($n?$n.identifier:null),gameData:Ee,randomSeeds:Lt()}]);Rn(o)}ye(e)},Ka=function(){var e=je.fromEventAction,t=void 0===e?null:e;ke(null),Re(null),t?Da():null!==tt?Aa():Pa()};Object(o.useEffect)((function(){if($n){var t=fe(N,$n.identifier),n=t.sequenceStyles,a=t.textStyle;aa(n),la(Object(d.a)({background:n.background,fontFamily:n.fontFamily},e.styles||{})),ga(a),da(t)}}),[$n]);var Za,Xa=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Na.current&&Na.current.playSound(e,t)},$a=function(){Na.current&&mt.sounds&&Na.current.stopAllSounds()},Qa=function(){Na.current&&mt.sounds&&Na.current.stopAllSfx()},er=function(){Na.current&&mt.sounds&&Na.current.fadeLoop()},tr=function(t){$a();var n=e.story.sequences?e.story.sequences[e.story.firstSequence]:null;t.sounds&&!e.isPreview&&Na.current&&n&&n.soundLoop&&n.soundLoop.sound&&Xa(n.soundLoop,!0);var a="default";n&&n.themeId&&(a=n.themeId);var r=e.story.themes.find((function(e){return e.identifier===a}));r&&r.identifier!==($n||{}).identifier&&Qn(r)},nr=function(e){u&&u(Ut),ct(!1),bt(e),fn(1),tr(e)},ar=function(){E&&E(),cr(!0),xn(0),vn(0),On(0),te([]),se([]),Y([N.firstSequence]),fn(0),Zt([]),en([]),rn([])},rr=function(){cr(!0),Ya()},or=function(){Na.current&&Na.current.togglePause(),sn(!0)},cr=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];sn(!1),Na.current&&(e?Na.current.resetPause():Na.current.togglePause())},lr=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];p?ja(!e||"reset"):e?ar():rr()},ir=N&&Wn&&Wn.length>0?Wn.filter((function(e){var t=e.gauge;return!t.condition||St(N,Ee,Vt,t.condition)})):null,sr=_[e.lang||"fr"],ur=N&&N.meta&&N.meta.options.displayTitleBar,dr=N&&N.meta&&N.meta.options.isCustomInventory;return N?c.a.createElement(D.Provider,{value:sr},c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:"story-player-container",style:ca},c.a.createElement(v.a,{className:ot||ln||Fn||An?"blurred":""},ur&&c.a.createElement("div",{className:"topbar",style:{background:na.topbarBackground,color:na.topbarText,fontFamily:Jn.styles.fontFamily,opacity:dr&&An?0:1}},"MOIKI ",N.meta?"- "+N.meta.name:""),c.a.createElement("div",{style:{display:"flex",width:"100%",height:ur?"calc(100% - 19px)":"100%",position:"relative"}},c.a.createElement(It,{theme:$n,images:N.images,bgStylesFix:l}),c.a.createElement("div",{className:"main-content"},(dr&&!An||!dr)&&(Ee.hero||Ee.objects&&Ee.objects.length>0||ir&&ir.length>0)&&c.a.createElement("div",{className:"game-bar",style:{background:na.assetsBackground}},c.a.createElement("div",{style:{display:"flex",alignItems:"center"}},Ee.hero?c.a.createElement(qe,{icon:(Za=Ee.hero,_a(Za).icon),className:"hero",style:{fill:na.assetsFill,stroke:na.assetsFill}}):c.a.createElement("div",null),c.a.createElement("div",{className:"gauges-container"},c.a.createElement("div",{className:"gauges-container-wrapper",style:{color:na.assetsFill}},ir&&ir.sort((function(e,t){return e.gauge.order-t.gauge.order})).map((function(t,n){var a=e.story.counters[t.id]||{},r=a.gauge,o=Object(m.a)(a,["gauge"]),l=Ee.counters.find((function(e){return e.id===t.id})).value;return c.a.createElement(Rt,{key:"gauge-"+n,value:isNaN(l)||null===l?o.defaultValue:l,gauge:r,counter:o,styles:na,computedStyles:ua})}))))),c.a.createElement("div",{className:"game-objects"},Ee.objects&&Ee.objects.length>0&&c.a.createElement("button",{style:Object(d.a)({},ua.button,{outline:"none",textShadow:"none"}),onClick:function(){return!je&&!Ce&&(Na.current&&Na.current.togglePause(),void Un(!0))}},c.a.createElement(g.a,{name:"star",style:{margin:0}})," (",Ee.objects.length,")"))),ot?null:c.a.createElement(He,{ref:za,story:N,gameData:Ee,path:Vt,routineExit:Kt&&Kt.length>0?Kt[Kt.length-1]:[],styles:ua,playClickSound:function(){na.sfx&&na.sfx.button&&Xa(na.sfx.button)},sequence:Fa(ge),gotoSequence:Ga,theme:{styles:na},showStats:or,reducedViewport:a,canUndo:N.meta&&N.meta.options&&N.meta.options.allowBack&&Vt.length>1&&(1===Cn.length&&!I(Vt,Cn[0].path)||Cn.length>1),undo:function(){var t=Cn[Cn.length-1];if(I(Vt,t.path)){var n=Cn.slice(0,-1);if(0===n.length)return;Rn(n),t=Cn[Cn.length-2]}var a=t,r=a.id,o=a.path,c=a.gameData,l=a.currentLoop,i=a.currentTheme,s=a.routinesExit,u=a.eventsDone,d=a.eventsPaused,m=Na.current?Na.current.getCurrentLoop():null;m&&m.sound&&l&&l.sound&&m.sound===l.sound?Qa():$a();var f=e.story.themes.find((function(e){return e.identifier===(i||"default")}));Qn(f),he(c),Gt(o),Zt(s),en(u),rn(d),xn(kn+1),l&&Xa(l,!0),wa(r),ye(r)},canAddReview:!1,canShowStats:T,onReplay:p?lr:null,randomSeeds:Cn.length>0?Cn[Cn.length-1].randomSeeds:Lt(),isPaused:ot||ln||zn||Fn||An,visible:!ot&&!Ce&&!je&&!ze&&!Ze&&!Ae,futureSequence:qa}))),e.showMenu&&c.a.createElement(Ft,{story:N,path:Vt,savePoints:Cn,computedStyles:ua,onUndo:function(){return za&&za.current&&za.current.undo()},onShowOptions:or,onShowAbout:function(){Na.current&&Na.current.togglePause(),Ln(!0)},onExit:q,displayExitButton:x}),N.meta&&N.meta.options.showStats&&c.a.createElement("div",{style:Object(d.a)({position:"absolute",bottom:0,right:0,padding:"0.4em 0.5em",opacity:.7},ua.sequence,{borderRadius:0,borderTopLeftRadius:"1em",outline:"none",border:"none"})},G.length," / ",H))),je&&c.a.createElement(Xe,{textStyle:ba,params:je,theme:{styles:na},onClosed:Ka}),Ce&&c.a.createElement(Mt,{textStyle:ba,params:Ce,theme:{styles:na},onClosed:Ka}),N.sounds&&c.a.createElement(Ke,{ref:Na,sounds:N.sounds,onReady:function(){return ht(!0)},onProgress:function(e){return wt(e)}}),pa&&c.a.createElement(gt,{alternate:!0,size:"mini",title:sr.RESUME,content:c.a.createElement("div",{style:{padding:"1em"}},c.a.createElement("p",null,sr.RESUME_MSG),c.a.createElement("p",null,c.a.createElement("b",null,(sr.RESUME_DATE||"").split("%s").join(Bt()(pa.delay,{language:e.lang||"fr",round:!0,largest:2})))),c.a.createElement("p",{style:{color:"#7a7a7a"}},c.a.createElement("em",null,sr.RESUME_ALERT))),cancelLabel:sr.DO_NOT_RESUME,cancelIcon:c.a.createElement(g.a,{name:"redo"}),confirmLabel:sr.LOAD,open:!!pa,onCancel:function(){Ea(null),nr({sounds:!0})},onConfirm:function(){_t=!0;var t=pa.data,n=pa.stats;if(Ea(null),u&&u(Ut),ct(!1),bt({sounds:!0}),t&&t.length>0){var a=t.pop();Rn(t);var r=a.id,o=a.path,c=a.gameData,l=a.currentLoop,i=a.currentTheme,s=a.routinesExit,d=a.eventsDone,m=a.eventsPaused,f=e.story.themes.find((function(e){return e.identifier===(i||"default")}));Qn(f),he(c),Gt(o),ye(r),Zt(s),en(d),rn(m),Y(n.sequencesShown),te(n.heroesShown),se(n.objectsShown),fn(n.numReplays),vn(n.numVictories),On(n.numDefeats),xn(n.numUndo),l&&Xa(l,!0)}}}),Sa&&c.a.createElement(gt,{size:"mini",title:"reset"===Sa?sr.RESET:sr.RESTART,content:c.a.createElement("div",{style:{padding:"1em"}},c.a.createElement("p",null,"reset"===Sa?sr.RESET_MSG:sr.RESTART_MSG,c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("b",null,sr.WILL_LOSE_BACKUP))),cancelLabel:sr.CANCEL,confirmLabel:"reset"===Sa?sr.RESET_GAME:sr.RESTART,open:!!Sa,onCancel:function(){ja(!1)},onConfirm:function(){var e="reset"===Sa;ja(!1),e?ar():rr()}}),ot&&!zn&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(it,{story:N,soundsLoaded:Et,soundsProgress:qt,onStart:nr,onShowCredits:function(){return Nn(!0)}})),ln&&!zn&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(st,{story:N,onClose:function(){return cr()},onShowCredits:function(){return Nn(!0)},onReset:function(){lr(!0)},onRestart:function(){lr()},gameOptions:mt,stats:{numSequencesShown:G.length,numSequencesTotal:H,numHeroesShown:ee.length,numHeroesTotal:Z,numObjectsShown:ie.length,numObjectsTotal:re,numUndo:kn,numReplays:mn,numVictories:yn,numDefeats:hn}})),Fn&&!zn&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(ft,{story:N,onClose:function(){Ln(!1),Na.current&&Na.current.togglePause()},showPlatformInfo:C})),zn&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(ut,{story:N,onClose:function(){return Nn(!1)}})),An&&c.a.createElement("div",{className:"story-overlay"},c.a.createElement(vt,{getAssetById:_a,objects:Ee.objects,onClose:function(){Un(!1),Na.current&&Na.current.togglePause()},styles:ua,showTitleBar:ur,defaultTheme:Jn,story:N,isCustomInventory:dr})))):null})),At=n(255),Ut=n.n(At),Ht=n(359),Pt=n.n(Ht),Wt=n(360),Vt=n.n(Wt),Gt=(n(679),["fr","en"]),Yt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",n={};return e.reduce((function(e,n){return Object(d.a)({},e,Object(u.a)({},n[t],n))}),n)};var Jt=function(){var e,t=Object(o.useRef)(null),n=Object(o.useState)(null),a=Object(s.a)(n,2),r=a[0],l=a[1],i=function(e,t){var n=function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(a){return t}},a=Object(o.useState)(n()),r=Object(s.a)(a,2),c=r[0],l=r[1];return Object(o.useEffect)((function(){var e=function(){return l(n())};return window.addEventListener("storage",e),function(){window.removeEventListener("storage",e)}}),[]),[c,function(t){try{var n=t instanceof Function?t(c):t;return l(n),window.localStorage.setItem(e,JSON.stringify(n)),!0}catch(a){return!1}}]}("moiki-player",{}),m=Object(s.a)(i,2),g=m[0],y=m[1],v=document.querySelector('meta[property="og:title"]').content,p=window.moiki_story,E=Vt.a.decode(Pt.a.decode(p));e=JSON.parse(Ut.a.AES.decrypt(E,v).toString(Ut.a.enc.Utf8));var h=window.language;if(Object(o.useEffect)((function(){e.routines&&e.routines.length>0&&function(e){var t,n=function(e,t){if(e)if(e.next&&(e.next=t+":"+e.next),"passage"===e.kind&&e.query.params&&e.query.params.length>0)e.query.params[0].target&&(e.query.params[0].target=t+":"+e.query.params[0].target);else if("multiple"===e.kind&&e.query.params&&e.query.params.length>0){var n,a=Object(b.a)(e.query.params||[]);try{for(a.s();!(n=a.n()).done;){var r=n.value;"passage"===r.kind&&r.target&&(r.target=t+":"+r.target)}}catch(o){a.e(o)}finally{a.f()}}},a=function(e,t){var a,r=Object(b.a)(e.conditions||[]);try{for(r.s();!(a=r.n()).done;){var o=a.value;n(o,t)}}catch(c){r.e(c)}finally{r.f()}},r=[{id:Object(R.a)(),sequences:e.sequences}].concat(Object(f.a)(e.routines)),o=0,c=Object(b.a)(r);try{for(c.s();!(t=c.n()).done;){var l,i=t.value,s=Object(b.a)(i.sequences);try{var u=function(){var e=l.value;e.id=o+":"+e.id,a(e,o),e.timer&&e.timer.next&&(e.timer.next=o+":"+e.timer.next);var t,c=Object(b.a)(e.choices||[]);try{for(c.s();!(t=c.n()).done;){var i=t.value;a(i,o),i.next&&(i.next=o+":"+i.next),i.showCondition&&n(i.showCondition,o)}}catch(v){c.e(v)}finally{c.f()}if(e.puzzle){e.puzzle.defaultNext&&(e.puzzle.defaultNext=o+":"+e.puzzle.defaultNext),e.puzzle.noObjectNext&&(e.puzzle.noObjectNext=o+":"+e.puzzle.noObjectNext);var s,u=Object(b.a)(e.puzzle.codes||[]);try{for(u.s();!(s=u.n()).done;){var d=s.value;d.next&&(d.next=o+":"+d.next)}}catch(v){u.e(v)}finally{u.f()}}if(e.routineId){var m=r.findIndex((function(t){return t.id===e.routineId}));e.redirectTo=m+":"+r[m].firstSequence;var f,g=Object(b.a)(e.routineExit||[]);try{for(g.s();!(f=g.n()).done;){var y=f.value;y.from=y.from?m+":"+y.from:y.from,y.next=y.next?o+":"+y.next:y.next,a(y,o)}}catch(v){g.e(v)}finally{g.f()}}e.next&&(e.next=o+":"+e.next)};for(s.s();!(l=s.n()).done;)u()}catch(S){s.e(S)}finally{s.f()}++o}}catch(S){c.e(S)}finally{c.f()}e.sequences=r.reduce((function(e,t){return[].concat(Object(f.a)(e),Object(f.a)(t.sequences))}),[]),e.firstSequence="0:"+e.firstSequence;var d,m=Object(b.a)(e.events);try{for(m.s();!(d=m.n()).done;){var g=d.value;g.condition&&n(g.condition,"0");var y,v=Object(b.a)(g.actions||[]);try{for(v.s();!(y=v.n()).done;){var p=y.value;"redirect"===p.kind&&p.params.target&&(p.params.target="0:"+p.params.target)}}catch(S){v.e(S)}finally{v.f()}}}catch(S){m.e(S)}finally{m.f()}var E,h=Object(b.a)(e.counters);try{for(h.s();!(E=h.n()).done;){var O=E.value;O.gauge&&O.gauge.condition&&n(O.gauge.condition,"0")}}catch(S){h.e(S)}finally{h.f()}}(e),l(Object(d.a)({},e,{sequences:Yt(e.sequences),images:Yt(e.images||[]),assets:Yt(e.assets||[]),sounds:Yt(e.sounds||[]),counters:Yt(e.counters||[]),textvars:Yt(e.textvars||[]),themes:e.themes||[Object(d.a)({},e.theme,{identifier:"default",idName:"default"})]}))}),[]),!e||!h)return null;Gt.includes(h)||(h="fr");var O=function(e){var t=e.path,n=void 0===t?[]:t;return e.data.map((function(e){return Object(d.a)({},e,{path:Array.isArray(e.path)?e.path:n.slice(0,e.path)})}))},S=function(e){var t=e&&e.length>0?e[e.length-1].path:null;return t?Array.isArray(t)?t.length:t:null};return r?c.a.createElement(Dt,{ref:t,lang:h,story:r,showMenu:!0,onReady:function(){if(g&&t.current){var e=g[r._id];if(e){var n=r.meta.modificationDate;if(e.version===n){var a=O(e);t.current.loadGame(Object(d.a)({},e,{data:a,delay:e.date?(new Date).getTime()-e.date:0}))}else console.log("oh oh ! there is a backup for this game, but the version has changed since then! will skip it :(")}}},onSavePoint:function(e){var t=e.data,n=e.stats;if(g&&r&&t.length>0&&S(t)>3){if(g[r._id]){var a=S(g[r._id].data),o=S(t);if(a&&a===o)return}y(Object(d.a)({},g,Object(u.a)({},r._id,Object(d.a)({version:r.meta.modificationDate,date:(new Date).getTime()},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=e[e.length-1].path,a=e.map((function(e){return Object(d.a)({},e,{path:Array.isArray(e.path)?e.path.length:e.path})}));return{path:n,data:a.slice(-t)}}(t),{stats:n}))))}}}):null};n(680),n(681);i.a.createRoot(document.getElementById("root")).render(c.a.createElement(Jt,null))}},[[373,1,2]]]);